<!----CSS LIBRARY---->
<link href="https://cdn.basiscore.net/basisfly.com/css/reservation_tem_style_res.css" type="text/css" rel="stylesheet" />
<link href="https://cdn.basiscore.net/basisfly.com/css/reservation_font_awesome.css" type="text/css" rel="stylesheet" />
<!----CSS CUSTOMIZE---->
<link href="[##cms.cms.cdn##]/css/style_tem_en.css" type="text/css" rel="stylesheet"/>
<!----JS LIBRARY---->
<script src="https://cdn.basiscore.net/basisfly.com/js/reservation_js_library.js" type="text/javascript"></script>
<basis core="call" file="header-en.inc" />
<basis core="dbsource" source="trust_login8" mid="24" name="db" lid="1" rkey="[##cms.cookie.rkey##]" >
    <member name="userid" type="scalar" request="userid"/>
</basis>
<basis core="group" name="Delay_1">
   <basis core="external.fly.ws" source="cmsDbService5" procedurename="dbsource" name="db">
    <member name="ShowDetail" method="hotel" query='{
        "name": "db",
        "mid": "20",
        "schemabase": "[##cms.query.schemabase|(true)##]",
        "schema": {
          "maininfo": {
            "action": "create",
            "childs": [
              {
                "reserveinfo": {
                  "action": "create",
                  "childs": [
                  {
                    "extra_service": {
                      "action": "find",
                      "map": "extra_service"
                    }
                  },
                    {
                      "hotelimage": {
                        "action": "find",
                        "map": "rooms.hotelinfo.hotelsearch.hotelimage"
                      }
                    },
                    {
                      "cityname": {
                        "action": "find",
                        "map": "hotelgroup.contry.cityname"
                      }
                    },
                    {
                      "name": {
                        "action": "find",
                        "map": "rooms.hotelinfo.hotelsearch.realname"
                      }
                    },
                    {
                      "star": {
                        "action": "find",
                        "map": "rooms.hotelinfo.hotelsearch.star"
                      }
                    }
                  ]
                }
              },
              {
                "reservtbl": {
                  "action": "create",
                  "childs": [
                    {
                      "rooms": {
                        "action": "find",
                        "map": "rooms",
                        "add": ["totalcom"],
                        "options": {
                          "index": {
                            "action": "find",
                            "map": "costinfo.index"
                          },
                          "roomname": {
                            "action": "find",
                            "map": "roomdata.roomname"
                          },
                          "service": {
                            "action": "find",
                            "map": "hotelinfo.hotelsearch.services"
                          },
                          "passengers": {
                            "action": "create",
                            "childs": [
                              {
                                "adults": {
                                  "action": "find",
                                  "map": "costinfo.adults"
                                },
                                "childswithbed": {
                                  "action": "find",
                                  "map": "costinfo.childswithbed"
                                },
                                "childswithoutbed": {
                                  "action": "find",
                                  "map": "costinfo.childswithoutbed"
                                },
                                "infant": {
                                  "action": "find",
                                  "map": "costinfo.infant"
                                }
                              }
                            ]
                          },
                          "arrivetimes": {
                            "action": "create",
                            "childs": [
                              {
                                "fdateHotel": {
                                    "action": "find",
                                    "map": "costinfo.dateinfo.start.sstring"
                                  },
                                  "fdateHotelM": {
                                    "action": "find",
                                    "map": "costinfo.dateinfo.start.mstring"
                                  }
                              }
                            ]
                          },
                          "exittimes": {
                            "action": "create",
                            "childs": [
                             {
                                "tdateHotel": {
                                    "action": "find",
                                    "map": "costinfo.dateinfo.end.sstring"
                                  },
                                  "tdateHotelM": {
                                    "action": "find",
                                    "map": "costinfo.dateinfo.end.mstring"
                                  }
                             }
                            ]
                          },
                          "totallast": {
                            "action": "find",
                            "map": "totalcom"
                          }
                        }
                      }
                    }
                  ]
                }
              },
              {
                "totalprice": {
                  "action": "create",
                  "childs": [
                    {
                      "total": {
                        "action": "find",
                        "map": "total"
                      }
                    },
                    {
                      "commission": {
                        "action": "find",
                        "map": "costcommission"
                      }
                    },
                    {
                      "moneytype": {
                        "action": "find",
                        "map": "moneytype"
                      }
                    },
                    {
                      "totalcom": {
                        "action": "find",
                        "map": "totalcom"
                      }
                    },
                    {
                      "totalorginal": {
                        "action": "find",
                        "map": "totalorginal"
                      }
                    },
                    {
                      "firstpay": {
                        "action": "find",
                        "map": "firstpay"
                      }
                    },
                    {
                      "coupon_data": {
                        "action": "find",
                        "map": "coupon_data"
                      }
                    }
                  ]
                }
              },
              {
                "Credit_payment": {
                  "action": "find",
                  "map": "Credit_payment"
                }
              },
              {
                "country_name": {
                  "action": "find",
                  "map": "hotelgroup.contry.countryname"
                }
              },
              {
                "internal": {
                  "action": "find",
                  "map": "internal"
                }
              },
              {
                "serviceid": {
                    "action": "find",
                    "map": "hotelgroup.serviceid"
                }
              },
              {
                "unit": {
                    "action": "find",
                    "map": "unit"
                }
               },
               {
                "hotel_dmnid": {
                    "action": "find",
                    "map": "hotelgroup.hotel_dmnid"
                }
            }
            ]
          }
        },
        "member": [
          {
            "type": "view",
            "name": "q",
            "request": "showdetail",
            "schemaid": "251",
            "lid": "2",
            "provider_basis": "[##cms.form.provider##]",
            "provider_ws":[##cms.form.mainprovider|("")##],
            "id": "[##cms.form.productid##]",
            "nights": "[##cms.form.nightLink##]",
            "rooms":[##cms.json.header|cms.form.rooms##],
            "optionId": "[##cms.form.optionId##]",
            "trackingNo": "[##cms.cookie.trackingid##]",
            "supplier": "[##cms.form.supplier##]",
            "userid": "[##db.userid.userid##]",
            "fromdate": "[##cms.form.fdate##]",
            "todate": "[##cms.form.tdate##]",
            "dmnid": "[##cms.cms.domainid##]",
            "unit": "10"
          }
        ]
      }
       ' />
  </basis>
   <basis core="group" name="Delay_2">
    <basis core="external.fly.ws" source="cmsDbService5" procedurename="dbsource" name="db">
        <member name="form" method="site"  query='{
            "name": "db",
            "mid": "20",
            "member": [
                {
                    "type": "list",
                    "name": "q",
                    "request": "form",
                    "schemaid": "251",
                    "ws": "[##cms.form.provider##]",
                    "adult": "0",
                    "child": "0",
                    "infant": "0",
                    "lid": "2",
                    "json": [##cms.json.header|cms.form.rooms##],
                    "trackingNo": "[##cms.cookie.trackingid##]"
                }
            ]
        }' preview="" />
    </basis>
  <basis core="group" name="Delay_3">
    <basis core="inlinesource" name="db">
        <member name="json" format="json" postsql="select  Id , ParentId , case when trim(Field) is null  then  (select field from [db.json] where id = a.parentid ) else field end as field, value , type , path  from [db.json] as a">{"root":[##db.ShowDetail.result##]}</member>
        <member name="firstpay" format="json" postsql="select value from [db.firstpay] where field = 'firstpay'"> {"root":[##db.ShowDetail.result##]} </member>
        <member name="country_name" format="json" postsql="select value from [db.country_name] where field = 'country_name'"> {"root":[##db.ShowDetail.result##]} </member>
        <member name="description" format="json" postsql="select value from [db.description] where field = 'description'"> {"root":[##db.ShowDetail.result##]} </member>
      </basis>
<!DOCTYPE html>
  <html>
    <head>
        <title>Hotel booking</title>
        <meta name="author" content="BasisCore">
         <meta name="viewport" content="width=device-width, minimum-scale=0.25, maximum-scale=1.0, initial-scale=1.0">
         <style type="text/css">
            <basis core="call" file="Client_reservation_css-en.inc"/>
        </style>
        <link rel="stylesheet" href="[##cms.cms.cdn##]/css/master-css.css" type="text/css">
    </head>
    <body class="st-effect-3" onload = "onloadFunc();">
        <input type="hidden" value="[##cms.form.checkpreurl##]" class="checkpreurl"/>
        <input type="hidden" value="[##db.userid.userid##]" class="useridshopper"/>
        <div id="bg-popup" style="display:none"></div>
        <div class="boxalert" style="display:none">
            <i class="fas fa-clock TimeoutIcon"></i>
            <div class="firstdiv"><span>Your search has expired</span></div>
            <div class="seconddiv"> <span class="secondalert"> Please click the button below to get the best prices and review the capacity.</span></div>
             <div class="optionsnodata">
                
                <input class="redirect hover" value="Home" onClick="window.location='/EN'" type="button">
                <form method="post" class="hsearch" action="/Test_Hotel_Search_EN.bc" style="display: inline-block;">
                    <input type="hidden" name="cityid" value="[##cms.form.cityid##]" />
                    <input type="hidden" name="fdate" value="[##cms.form.fdate##]" />
                    <input type="hidden" name="tdate" value="[##cms.form.tdate##]" />
                    <input type="hidden" name="nights" value="[##cms.form.nightLink##]" />
                    <input type="hidden" name="edit" value="0" />
                    <input type="hidden" name="coHotel" value="[##cms.form.coHotel##]" />
                    <input type="hidden" name="roomSearch" value='[##cms.form.roomSearch##]' />
                    <input class="researchnodata" value="Search update" type="submit" id="redirect" />
                </form>
              
            </div>
        </div>
        <div id="app"></div>
      
            <basis core="tree" datamembername="db.json" idcol="id" parentidcol="parentid" nullvalue="null">
                <face filter="field = 'msg' and value = 'no data'">
                    <div id="bg-popup" style="display:block"></div>
                    <div class="boxalert">
                        <i class="fas fa-exclamation-triangle NoResultIcon"></i>
                        <div class="firstdiv"><span> An error occurred while the hotel could not be booked .</span></div>
                        <div class="seconddiv"> <span class="secondalert"> Please click the button below to review again.</span></div>      
                        <div class="optionsnodata">
                            <input class="redirect hover" value="Home" onClick="window.location='/EN'" type="button">
                            <form method="post" class="hsearch" action="/Test_Hotel_Search_EN.bc" style="display: inline-block;">
                                <input type="hidden" name="cityid" value="[##cms.form.cityid##]" />
                                <input type="hidden" name="fdate" value="[##cms.form.fdate##]" />
                                <input type="hidden" name="tdate" value="[##cms.form.tdate##]" />
                                <input type="hidden" name="nights" value="[##cms.form.nightLink##]" />
                                <input type="hidden" name="edit" value="0" />
                                <input type="hidden" name="coHotel" value="[##cms.form.coHotel##]" />
                                <input type="hidden" name="roomSearch" value='' class="roomnodata" />
                                <input class="researchnodata" value="Search update" type="submit" id="redirect" />
                            </form>
                        </div>
                    </div>
                </face>
                <face filter="field = 'error' and value = '1'">
                    <div id="bg-popup" style="display:block"></div>
                    <div class="boxalert">
                        <i class="fas fa-exclamation-triangle NoResultIcon"></i>
                        <div class="firstdiv"><span>  The hotel can not be booked ، [##db.description.value##]  </span></div>
                        <div class="seconddiv"> <span class="secondalert"> Please click the button below to review again.</span></div>      
                        <div class="optionsnodata">
                            <input class="redirect hover" value="Home" onClick="window.location='/EN'" type="button">
                            <form method="post" class="hsearch" action="/Test_Hotel_Search_EN.bc" style="display: inline-block;">
                                <input type="hidden" name="cityid" value="[##cms.form.cityid##]" />
                                <input type="hidden" name="fdate" value="[##cms.form.fdate##]" />
                                <input type="hidden" name="tdate" value="[##cms.form.tdate##]" />
                                <input type="hidden" name="nights" value="[##cms.form.nightLink##]" />
                                <input type="hidden" name="edit" value="0" />
                                <input type="hidden" name="coHotel" value="[##cms.form.coHotel##]" />
                                <input type="hidden" name="roomSearch" value='' class="roomnodata" />
                                <input class="researchnodata" value="Search update" type="submit" id="redirect" />
                            </form>
                        </div>
                    </div>
    
                </face>
                
                <face filter="type in ('object','array')">@child</face>
            </basis>
     
        <div class="popup-container">
            <span class="close CloseBox"><i class="fa fa-times" aria-hidden="true"></i></span>
            <div class="popup-container_content"></div>
        </div>
    <main id="main" class="contain-currency-show">
    <section class="loginRegister"></section>
    <div class="main-inner">
    <div class="Details_box">
        <div class="Head-titr">
            <div id="detailsHotel" class="active-titr"><span><i class="fas fa-info-circle"></i></span><span>Hotel details</span></div>
            <div id="ruleRoom"><span><i class="fas fa-bed"></i></span><span>Room rules</span></div>
        </div>
        <div class="moredetails-box">
            <span class="close CloseBox"><i class="fa fa-times" aria-hidden="true"></i></span>
            <basis core="tree" datamembername="db.json" idcol="id" parentidcol="parentid" nullvalue="null">
                <face filter="field = 'reservtbl'">
                    <div class="Hotel_information">
                    <div cellpadding="0" cellspacing="0" align="center" class="tblreserv Hoteltbl">
                        <div class="tblreserv-head">
                            <div class="tblreserv-row tblreserv-head-row">
                                <div class="each-tlt-cell"> Room</div>
                                <div class="each-tlt-cell">Room type</div>
                                <div class="each-tlt-cell">Services</div>
                                <div class="each-tlt-cell">passengers</div>
                                <div class="each-tlt-cell">Entry date</div>
                                <div class="each-tlt-cell">Exit date</div>
                            </div>
                        </div>
                         @child
                    </div>
                    </div>
                    </face>
                    <face filter="Field= 'rooms' and type='Object'">
                        <div class="tblreserv-row"> @child </div>
                    </face>
                    <face filter="Field= 'index'">
                        <div class="each-cell" data-label="Room">
                            <div class="info-txt indexRoom"> @value </div>
                        </div>
                    </face>
                    <face filter="Field= 'roomname'">
                        <div class="each-cell" data-label="Room type">
                            <div class="info-txt"> @value </div>
                        </div>
                    </face>
                    <face filter="Field= 'service'">
                        <div class="each-cell" data-label="Services">
                            <div class="info-txt"> @value </div>
                        </div>
                    </face>
                    <face filter="Field = 'passengers'">
                        <div class="each-cell" data-label="passengers"><div class="info-txt" style="direction:rtl;">@child</div></div>
                    </face>

                    <face filter="Field= 'adults'">
                        <span>@value Adult</span>
                    </face>
                    <face filter="Field= 'childswithbed' and value <>'0'">
                        <span class="with-bed"><span> + @value</span>Child </span></span>
                    </face>
                    <face filter="Field= 'childswithoutbed' and value <>'0'">
                        <span class="childswithoutbedmain without-bed">
                            <span style="margin: 0 5px;"> + @value</span> Child </span>
                    </face>
                    <face filter="Field= 'infant' and value <>'0'">
                        <span class="childswithoutbedmain is-infant">
                            <span style="margin: 0 5px;"> + @value</span> Infant </span>
                    </face>
                    <face filter="field = 'arrivetimes'">
                        <div class="each-cell" data-label="Entry date"><div class="info-txt">@child</div></div>
                    </face>
                    <face filter="Field= 'fdateHotelM' and type='Scalar.String' and value <> 'undefined'">
                            <span class="mstring">(@value)</span>
                    </face>
                    <face filter="field = 'exittimes'">
                        <div class="each-cell" data-label="Exit date"><div class="info-txt">@child</div></div>
                    </face>
                    <face filter="Field= 'tdateHotelM' and type='Scalar.String' and value <> 'undefined'">
                        <span class="mstring">(@value)</span>
                    </face>
                    <face filter="type in ('object','array')">@child</face>
                </basis>
                <div class="RuleRoom_info">
                    <div><span class="click" onclick="ShowRoomRule(this)"> Click </span><span> to view room rules ! </span></div>
                    <div class="resultRoomRule"> </div>
                    <div class="loadingLog">
                        <div id="ballsWaveG">
                         <div id="ballsWaveG_1" class="ballsWaveG"></div>
                         <div id="ballsWaveG_2" class="ballsWaveG"></div>
                         <div id="ballsWaveG_3" class="ballsWaveG"></div>
                         <div id="ballsWaveG_4" class="ballsWaveG"></div>
                         <div id="ballsWaveG_5" class="ballsWaveG"></div>
                         <div id="ballsWaveG_6" class="ballsWaveG"></div>
                         <div id="ballsWaveG_7" class="ballsWaveG"></div>
                         <div id="ballsWaveG_8" class="ballsWaveG"></div>
                        </div>
                    </div>
                </div>
        </div>
        </div>
        <div class="rsvsteps">
            <div class="steps">
                <div class="visited"><span class="content-steps"><span class="em">Hotel search</span></span></div>
                <div><span class="content-steps"><span class="counter-steps"></span><span class="em eminext">Passenger information</span></span></div>
                <div><span class="content-steps"><span class="counter-steps"></span><span class="em eminext">Buyer information</span></span></div>
                <div class="service-step"><span class="content-steps"><span class="counter-steps"></span><span class="em eminext">Service and transfer</span></span></div>
                <div><span class="content-steps"><span class="counter-steps"></span><span class="em eminext">Pre-invoice and payment</span></span></div>
            </div>
        </div>
        <div class="reserve_reisze">
            <div class="reserve_box">
                <div class="reserve_left_side">
                    <div class="bascket_info_Tab">
                        <div class="reserve_box_title">
                            <span>Cart</span>
                        </div>
                        <div class="bascket_info">
                            <div class="bascket_info_inner">
                                <div class="ticket_info">
                                    <div class="Arr_info Arr_infoHotel">
                                        <basis core="tree" datamembername="db.json" idcol="id" parentidcol="parentid" nullvalue="null">
                                            <face filter="Field = 'extra_service'">
                                                <input type="hidden" value='@value' class="hotel_extra_service"/>
                                            </face>
                                            <face filter="Field = 'hotelimage' and type='Scalar.String' and path = '.root[0].maininfo.reserveinfo.hotelimage[0]'">
                                                <div class="hotelimage"><img src="@value" alt="hotelimage" width="145" height="145" /></div>
                                            </face>
                                            <face filter="Field = 'hotelimage' and type='Scalar.String' and path = '.root[0].maininfo.reserveinfo.hotelimage'">
                                                <div class="hotelimage"><img src="@value" alt="hotelimage" width="145" height="145" /></div>
                                            </face>
                                            <face filter="Field = 'cityname' and path = '.root[0].maininfo.reserveinfo.cityname'">
                                                <span class="subject_info">City : </span><span> @value </span><span class="travel-date">[##cms.form.fdate##]</span><span class="travel-date">-</span><span class="travel-date">[##cms.form.tdate##]</span></span><br/>
                                            </face>
                                            <face filter="Field = 'name' and type='Scalar.String' and path='.root[0].maininfo.reserveinfo.name[0]'">
                                                <span class="subject_info"> Hotel : </span><span> @value </span><br/>
                                                <input type="hidden" value="@value" class="hotel-name" />
                                            </face>
                                            <face filter="Field = 'name' and type='Scalar.String' and path='.root[0].maininfo.reserveinfo.name'">
                                                <span class="subject_info"> Hotel : </span><span> @value </span><br/>
                                                <input type="hidden" value="@value" class="hotel-name" />
                                            </face>
                                            <face filter="Field = 'star' and type='Scalar.Numeric' and path='.root[0].maininfo.reserveinfo.star[0]'">
                                                <span class="subject_info"> Degree : </span><span> <img src="/images/@value-rating.png" alt="Degree Hotel" width="80" height="16" /> </span><br/>
                                                <span class="subject_info">Staying time : </span><span> [##cms.form.nightLink##] Nights</span><br/>
                                            </face>
                                            <face filter="Field = 'star' and type='Scalar.Numeric' and path='.root[0].maininfo.reserveinfo.star'">
                                                <span class="subject_info"> Degree : </span><span> <img src="/images/@value-rating.png" alt="Degree Hotel" width="80" height="16" /> </span><br/>
                                                <span class="subject_info">Staying time : </span><span> [##cms.form.nightLink##] Nights</span><br/>
                                            </face>
                                            <face filter="Field = 'index'">
                                                <span class="subject_info">Room @value : </span>
                                            </face>
                                            <face filter="Field = 'passengers'">
                                                <div class="passengers-info">@child</div>
                                            </face>
                                            <face filter="Field= 'adults'">
                                                <span> @value Adult </span> 
                                            </face>
                                            <face filter="Field= 'childswithbed' and value <>'0'">
                                                <span class="with-bed"> + @value Child  </span>
                                            </face>
                                            <face filter="Field= 'childswithoutbed' and value <>'0'">
                                                <span class="without-bed"> + @value Child  </span>
                                            </face>
                                            <face filter="Field= 'infant' and value <>'0'">
                                                <span class="is-infant"> + @value Infant </span>
                                            </face>
                                            <face filter="type in ('object','array')"> @child </face>
                                        </basis>
                                    </div>
                                    <div class="clr"></div>
                                    <span class="more_details"><i class="fal fa-angle-double-left"></i><span>Show more details</span></span>
                              
                                </div>
                             
                        </div>
                    </div>
                </div>
            </div>
                <div class="reserve_right_side">
                    <div class="wrapper-counter_box">
                        <div class="reserve_box_title inner_box">
                            <div class="counter_box">
                                <i class="fas fa-clock"></i>
                                <div class="ttcounter">The remaining time of the booking process</div>
                                <span id="count"></span>
                            </div>
                            <div class="step_title">
                                <span>Passenger profile</span><span class="step-title-fa unvisible"><span class="dash">-</span>اطلاعات مسافر</span>
                            </div>
                            <div class="clr"></div>
                        </div>
                    </div>
                    <div class="reserve_info_Tab">
                        <div class="Info_box">
                            <div class="info_box_inner">
                                <div id="passenger_box" class="rsv_box">
                                    <form method="post" action="/Test_Final_Hotel_en.bc" id="finalforminvoice">
                                        <div class="infoForm-load">
                                            <div id="passonly">
                                                <input type="hidden" name="_root.account.fullname.firstname" value="" class="rootFirstname pasii" />
                                                <input type="hidden" name="_root.account.fullname.lastname" value="" class="rootLastname pasii" />
                                                <input type="hidden" name="_root.account.email" value="" class="rootEmail pasii" />
                                                <input type="hidden" name="_root.account.tel" value="" class="rootTel pasii" />
                                                <input type="hidden" name="_root.account.mobile" value="" class="rootMobile pasii" />
                                                <input type="hidden" name="_root.account.address" value="" class="rootAdrress pasii" />
                                                <input type="hidden" name="_root.account.gender" value="" class="rootGender pasii" />
                                                <input type="hidden" name="_root.account.birthdate" value="" class="rootBirthdate pasii" />
                                                <input type="hidden" name="_root.account.codepost" value="" class="rootCodepost pasii" />
                                                <input type="hidden" name="_root.account.fax" value="-" class="rootFax pasii" />
                                                <input type="hidden" name="_root.account.countryid" value="" class="rootCountryid pasii" />
                                                <input type="hidden" name="_root.account.cityid" value="" class="rootCityid pasii" />
                                            </div>
                                            <div id="agenconly">
                                                <input type="hidden" name="_root.account.Agencyname" value="" class="rootnameAgency agencii" />
                                                <input type="hidden" name="_root.account.Agencymanegername" value="" class="rootmanegerAgency agencii" />
                                                <input type="hidden" name="_root.account.namecounter" value="" class="rootnamecounter agencii" />
                                                <input type="hidden" name="_root.account.familycounter" value="" class="rootfamilycounter agencii" />
                                                <input type="hidden" name="_root.account.emailcounter" value="-" class="rootemailcounter agencii"/>
                                                 <input type="hidden" name="_root.account.mobilecounter" value="-" class="rootmobilecounter agencii"/>
                                                <input type="hidden" name="_root.account.Agencytell" value="" class="roottellAgency agencii" />
                                                <input type="hidden" name="_root.account.Agencymobile" value="" class="rootmobileAgency agencii" />
                                                <input type="hidden" name="_root.account.Agencyaddress" value="" class="rootaddressAgency agencii" />
                                                <input type="hidden" name="_root.account.Agencyemail" value="" class="rootemailAgency agencii" />
                                                <input type="hidden" name="_root.account.Agencyweb" value="" class="rootwebAgency agencii" />
                                                <input type="hidden" name="_root.account.Agencyfax" value="-" class="rootfaxAgency agencii" />
                                                <input type="hidden" name="_root.account.countryid" value="" class="rootCountryid agencii" />
                                                <input type="hidden" name="_root.account.cityid" value="" class="rootCityid agencii" />
                                                <input type="hidden" name="_root.account.agencyid" value="" class="rootagencyid agencii" />
                                            </div>
                                        </div>
                                        <input type="hidden" value="0" name="c_code" class="c_code" />
                                        <input type="hidden" value="-" name="bank_id" class="bank_id" />
                                        <input type="hidden" value="0" name="agencycounter" class="agcounter" />
                                        <input type="hidden" value="-" name="agencycountername" class="agcountername" />
                                        <input type="hidden" value='[##cms.form.mainprovider|("")##]' name="providerws" class="mainprovider" />
                                        <input type="hidden" value='[##cms.form.nightLink##]' name="nightLink" />
                                        <input type="hidden" name="roomSearch" value='[##cms.form.roomSearch##]' />
                                        <input type="hidden" name="rooms" value='[##cms.json.header|cms.form.rooms##]' />
                                        <input type="hidden" value="[##cms.form.productid##]" name="productid" />
                                        <input type="hidden" value="" name="agcname" class="nameAgencyFct" />
                                        <input type="hidden" value="[##cms.form.supplier##]" name="supplier" />
                                        <input type="hidden" value="[##cms.form.share##]" name="share" />
                                        <input type="hidden" name="fdate" value='[##cms.form.fdate##]' />
                                        <input type="hidden" name='provider' value='[##cms.form.provider##]' />
                                        <input type="hidden" name='optionId' value='[##cms.form.optionId##]' class="optionId" />
                                        <input type="hidden" name='mainprovider' value='[##cms.form.mainprovider##]' />
                                        <input type="hidden" name="tdate" value='[##cms.form.tdate##]' />
                                        <input type="hidden" value="0" name="adultcount" class="adultcount" />
                                        <input type="hidden" value="0" name="childcount" class="childcount" />
                                        <input type="hidden" value="0" name="infantscount" class="infantscount" />
                                        <input type="hidden" name="userid" value='[##db.userid.userid##]' class="mainuserid" />
                                        <input type="hidden" value="" name="mid" class="midlog midagencyall" />
                                        <input type="hidden" value="" name="accounttype" class="accounttypetotal" />
                                        <input type="hidden" value="[##cms.form.hotelid##]" name="hotelid" class="hotelid" />
                                        <input type="hidden" value="[##cms.form.productid##]" name="id" />
                                        <input type="hidden" value="" name="paytype" class="paytype" />
                                        <input type="hidden" value="" name="clear" class="clear"/>
                                        <input type="hidden" value="" name="agencyid" class="agencyidmain" />
                                        <input type="hidden" value="" name="roomid" class="roomidmain" />
                                        <input type="hidden" value="[##cms.form.cityid##]" name="cityid"/>
                                        <input type="hidden" value="[##cms.form.coHotel##]" name="coHotel"/>
                                        <input type="hidden"  value="0" name="club_discount" class="club_discount"/>
                                        <input type="hidden"  value='' name="invoicedesc" class="invoicedesc"/>
                                        <input type="hidden" value='0' name="has_products" class="has_products" />
                                        <input type="hidden" value="0" class='step-payment' />
                                        <input type="hidden" value="[##cms.form.rate-unit##]" class="rate-unit" name="currency_request"/>
                                        <input type="hidden" value="[##cms.form.rate-cost##]" class="rate-cost"/>
                                        <input type="hidden" value="[##cms.form.rate-floatdigit##]" class="rate-floatdigit"/>
                                        <basis core="tree" datamembername="db.json" idcol="id" parentidcol="parentid" nullvalue="null">
                                            <face filter="field = 'moneytype'">
                                                <input type="hidden" value="@value" name="moneytype"/>
                                            </face>
                                            <face filter="field='Credit_payment'">
                                                <input type="hidden" value="@value" class="Credit_payment"  name="Credit_payment"/>
                                            </face>
                                            <face filter="field = 'fdateHotelM'">
                                                <input type="hidden" value="@value" class="mdate_dep"/>
                                            </face>
                                            <face filter="field='internal'">
                                                <input type="hidden" value="@value" class="internal"/>
                                            </face>
                                            <face filter="field='serviceid'">
                                                <input type="hidden" value="@value" class='serviceid' />
                                            </face>
                                            <face filter="field='hotel_dmnid'">
                                                <input type="hidden" value="@value" class='hotel_dmnid' />
                                            </face>
                                            <face filter="field='unit'">
                                                <input type="hidden" value="@value" class="currency-unit"/>
                                            </face>
                                            <face filter="type in ('object','array')">@child</face>
                                        </basis>
                                        
                                        <div class="alert-tlt"></div>
                                        <div id="passengers"></div>
                                        <div id="hotel-services-container" class="unvisible"></div>
                                    </form>
                                    <basis core="group" if="'[##db.userid.userid##]'='0'">
                                        <div class="next_level shine-hover next_level_notlog" id="infovalidate" data-validate="0"><span>Next</span></div>
                                        <form method="post" action="/Test_Commission.bc" class="addcommission">
                                            <input type="hidden" value="3" name="type" />
                                            <input type="hidden" value="2" name="lid" />
                                            <input type="hidden" value="[##cms.form.provider##]" name="provider" />
                                            <input type="hidden" value='[##cms.form.mainprovider|("")##]' name="mainprovider" />
                                            <input type="hidden" value="[##cms.form.productid##]" name="productid" />
                                            <input type="hidden" value="[##cms.form.nightLink##]" name="nightLink" />
                                            <input type="hidden" value="[##cms.form.optionId##]" name="optionId" />
                                            <input type="hidden" name="rooms" value='[##cms.json.header|cms.form.rooms##]' />
                                            <input type="hidden" value="[##cms.form.supplier##]" name="supplier" />
                                        </form>
                                    </basis>
                                    <basis core="group" if="'[##db.userid.userid##]'<>'0'">
                                        <div class="next_level islogin shine-hover" id="infovalidate" data-validate="0" ><span>Next</span></div>
                                    </basis>
                                </div>
                                <div id="shopper_box" class="rsv_box">
                                    <div class="shopper_box_inner">
                                        <div class="comInfo"></div>
                                        <div class="loadhere"></div>
                                    </div>
                                </div>
                                <div id="hotel_services_box" class="rsv_box" data-open="0"></div>
                                <div id="invoice_box" class="rsv_box">
                                    <div class="invoice_box_info">
                                        <div class="Pass_info inner_box">
                                            <h3 class="tiltelast"><span>Passenger profile </span></h3>
                                            <div class="tableinformation">
                                                <div class="pass-info-table pre_invoice" cellspacing="0">
                                                    <div class="passengerInfoes"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="Shopper_info inner_box">
                                            <h3 class="tiltelast"><span>Buyer details </span></h3>
                                            <div class="shopper_loadinfo loadhere2">
                                                <div class="buyer_box2"  style="display:none;" id="onlyuser3">
                                                    <div class="buyer_info_tbl">
                                                        <colgroup >
                                                            <col width="10%" />
                                                            <col width="30%" />
                                                            <col width="10%" />
                                                            <col width="30%" />
                                                        </colgroup>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-user fa-user-shopper"></i></span><span class="question">Full name :</span> </div>
                                                            <div><span class="answer firstnameFinal"></span><span class="answer lastnameFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-phone"></i></span><span class="question">Phone number :</span></div>
                                                            <div><span class="answer phoneFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-mobile"></i></span><span class="question">Mobile number :</span></div>
                                                            <div><span class="answer mobileFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-envelope"></i></span><span class="question">Email :</span></div>
                                                            <div><span class="answer postEmailFinal"></span> </div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fa fa-map-marker" aria-hidden="true"></i></span><span class="question">Address :</span></div>
                                                            <div><span class="answer addressFinal"></span></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="buyer_box2" style="display:none;" id="onlyuser2">
                                                    <div class="buyer_info_tbl">
                                                        <colgroup >
                                                            <col width="10%" />
                                                            <col width="30%" />
                                                            <col width="10%" />
                                                            <col width="30%" />
                                                        </colgroup>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fal fa-building"></i></span><span class="question">Agency name :</span> </div>
                                                            <div><span class="answer nameAgencyFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-user fa-user-shopper"></i></span><span class="question">Managing Director :</span></div>
                                                            <div><span class="answer manegerAgencyFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-phone"></i></span><span class="question">Phone number :</span></div>
                                                            <div><span class="answer tellAgencyFinal"></span> </div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-mobile"></i></span><span class="question">Mobile number :</span></div>
                                                            <div><span class="answer mobileAgencyFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-envelope"></i></span><span class="question">Email :</span></div>
                                                            <div><span class="answer emailAgencyFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fa fa-map-marker" aria-hidden="true"></i></span><span class="question">Address:</span></div>
                                                            <div><span class="answer addressAgencyFinal"></span></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="buyer_box2"  style="display:none;" id="onlyuser1">
                                                    <div class="buyer_info_tbl">
                                                        <colgroup>
                                                            <col width="10%" />
                                                            <col width="30%" />
                                                            <col width="10%" />
                                                            <col width="30%" />
                                                        </colgroup>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fal fa-building"></i></span><span class="question">Agency name :</span> </div>
                                                            <div><span class="answer nameAgencyFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-user fa-user-shopper"></i></span><span class="question">Managing Director :</span></div>
                                                            <div><span class="answer manegerAgencyFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-phone"></i></span><span class="question">Phone number :</span></div>
                                                            <div><span class="answer tellAgencyFinal"></span> </div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-mobile"></i></span><span class="question">Mobile number :</span></div>
                                                            <div><span class="answer mobileAgencyFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-envelope"></i></span><span class="question">Email :</span></div>
                                                            <div><span class="answer emailAgencyFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fa fa-map-marker" aria-hidden="true"></i></span><span class="question">Address :</span></div>
                                                            <div><span class="answer addressAgencyFinal"></span></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="buyer_box2"  style="display:none;" id="onlyuser1a">
                                                    <div class="buyer_info_tbl">
                                                        <colgroup >
                                                            <col width="10%" />
                                                            <col width="30%" />
                                                            <col width="10%" />
                                                            <col width="30%" />
                                                        </colgroup>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-user fa-user-shopper"></i></span><span class="question">Full name :</span> </div>
                                                            <div><span class="answer firstnameFinal"></span><span class="answer lastnameFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-phone"></i></span><span class="question">Phone number :</span></div>
                                                            <div><span class="answer phoneFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-mobile"></i></span><span class="question">Mobile number :</span></div>
                                                            <div><span class="answer mobileFinal"></span></div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fas fa-envelope"></i></span><span class="question">Email :</span></div>
                                                            <div><span class="answer postEmailFinal"></span> </div>
                                                        </div>
                                                        <div class="info-view">
                                                            <div><span class="shopper-icon"><i class="fa fa-map-marker" aria-hidden="true"></i></span><span class="question">Address :</span></div>
                                                            <div><span class="answer addressFinal"></span></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="clr"></div>
                                            </div>
                                            <div class="clr"></div>
                                        </div>
                                        <div class="hotel_services_info inner_box">
                                            <h3 class="tiltelast"><span>Service and trasfer</span></h3>
                                            <div class="hotel_services_info_container"></div>
                                        </div>
                                        <div class="clr"></div>
                                    </div>
                                    <div class="invoice_box_exinfo inner_box">
                                      <div id="Coupon_box">
                                          <div class="Content-CheckCoupon wrapper-discount">
                                              <input type="checkbox" onchange="discount_member_point(this)"  value="0" name="discount"/>
                                              <label><span class="radiobox"></span></label>
                                              <div class="section-discount">
                                                  <span class="box_tlt"><span class="shopper-icon"><i class="fas fa-tags"></i></span><span>discount code </span></span>
                                                  <form method="POST" action="/Test_CheckCoupon_en.bc" class="checkcoupon section-discount-wrapper unvisible">
                                                      <input type="text" name="couponcode" class="couponcode" autocomplete="off" />
                                                      <input type="hidden" value="0" class="transfer-for-coupon"/>
                                                      <input type="submit" class="submit" value="Check the code" />
                                                      <span class="CheckCoupon-loading"><img src="/images/load.gif" width="20" height="20"/></span>
                                                      <span class="couponresult"></span>
                                                  </form>
                                              </div>
                                              <div class="clr"></div>
                                          </div>
                                          <div class="Content-CheckCoupon wrapper-discount checkMemberPoint"></div>
                                      </div>
                                        <div id="Counter_list"></div>
                                        <div class="section_note">
                                          <span class="box_tlt"><span class="shopper-icon"><i class="fas fa-sticky-note"></i></span><span>Notes : </span></span>
                                          <_textarea class="invoice_note" placeholder="Notes ..."></_textarea>
                                        </div>
                                            <div class="clr"></div>
                                            <div class="confirmeReserve">
                                                <input type="checkbox" name="rullcheck" class="rullcheck">
                                                <label for="rullcheck"><span class="checkbox"></span></label>
                                                <span class="ruletxt"><span id="tarlink">Terms and Conditions</span> I have read this contract in full and I accept its terms, which will be approved by selecting this section .</span>
                                                <p class="alertcheck">Please read the rules section.</p>
                                                <div class="clr"></div>
                                            </div>
                                            <div class="clr"></div>
                                            </div>
                                            <div class="invoice_box_final">
                                                <div class="redirectBank">
                                                    <div class="next_level showbank shine-hover"><span>Select payment</span></div>
                                                    <div class="prev_level invoice_prev_level shine-hover"><span>Previous</span></div>
                                                    <div class="clr"></div>
                                                      <div id="Section-Credit-Payment" class="onlinepayment" data-pay = 'credit' data-clear='6' data-clicked ='0'></div>
                                                      <div id="Bank-list" class="onlinepayment" data-pay = 'bank' data-clear='0' data-clicked ='0'></div>
                                                     <div class="waiting_text wait_bank">Connecting to the payment portal, please wait</div>
                                                    <div class="waiting_text wait_credit">Contract issuance, please wait</div>    
                                                    <div class="clr"></div>
                                                </div>
                                                <div class="noBank">
                                                    <div class="next_level hidebank shine-hover"><span>Check out: Final Details</span></div>
                                                    <div class="prev_level invoice_prev_level shine-hover"><span>Previous</span></div>
                                                    <div class="clr"></div>
                                                    <div class="formaccounting inner_box hover" data-clicked ='0'>
                                                        <div><span><span class="click_accounting">Click</span> to pre-contract and send to accounting</span></div>
                                                    </div>
                                                    <div class="waiting_text">Pre-contracting, please wait</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="clr"></div>
                                    </div>
                                    <div class="clr"></div>
                                </div>
                                <div class="clr"></div>
                            </div>
                </div>
                <basis core="tree" datamembername="db.json" idcol="id" parentidcol="parentid" nullvalue="null">
                    <face filter="field = 'totalprice'">
                        <div class="cost_info">
                            <ul>@child</ul>
                        </div>
                    </face>
                    <face filter="field = 'moneytype'">
                        <input type="hidden" value="@value" class="moneytypeInfo" />
                    </face>
                    <face filter="field = 'total'">
                        <li class="total-section">
                            <div class="view-service-price"></div>
                            <input type="hidden" value="@value" class="total" />
                            <div class="reserv_cost_title">Hotel price:</div>
                            <div class="reserv_cost_title"> <span class="cost">@value</span> <span class="moneytype"></span></div></li>
                    </face>
                    <face filter="field = 'commission' and value <>'0'">
                        <li class="commissionresize commisson-section">
                            <input type="hidden" value="@value" class="commisson" />
                            <div class="reserv_cost_title">Commission deduction:</div>
                            <div class="reserv_cost_title"><span class="cost commissonCount">@value</span> <span
                                    class="moneytype"></span></div></li>
                    </face>
                    <face filter="field = 'commission' and value ='0'">
                        <li class="commissionresize commisson-section" style="display:none">
                            <input type="hidden" value="@value" class="commisson" />
                            <div class="reserv_cost_title">Commission deduction:</div>
                            <div class="reserv_cost_title"><span class="cost commissonCount">@value</span> <span
                                    class="moneytype"></span></div></li>
                    </face>
                    <face filter="field = 'totalcom'">
                        <li class="totalcomresize totalcom-section" style="display:none">
                            <input type="hidden" value="@value" class="totalcom" />
                            <div class="reserv_cost_title">Amount with commission deduction:</div>
                            <div class="reserv_cost_title"> <span class="cost finaltotalcom">@value</span> <span
                                    class="moneytype"></span></div></li>
                    </face>
                    <face filter="field = 'firstpay'">
                            <div class="allcost01">The amount payable</div>
                            <div class="allcost">
                                <div class="reserv_cost_title firstpay-section"> <span class="cost finalprice" id="lastprice" data-price="@value">@value</span> <span
                                        class="moneytype"></span></div>
                                <input type="hidden" value="@value" class="price_firstpay" data-firstpay="@value" /></div>
                    </face>
                    <face filter="field = 'coupon_data'">
                        <input type="hidden" name="coupondata" class="coupondata" value='@value' />
                    </face>
                    <face filter="type in ('object','array')">@child</face>
                </basis>
                    <div class="clr"></div>
                </div>
                <div class="clr"></div>
            </div>
            <div class="clr"></div>
        </div>
        <div class="clr"></div>
    </main>
    <script type="text/javascript" src="https://www.basisfly.com/js/reservation_moment-with-locales.js"></script><!--Clock-->
    <script type="text/javascript" src="https://www.basisfly.com/js/reservation_bootstrap-clockpicker.min.js"></script><!--Clock--> 
  <script type="text/javascript">
  /*------------------START FUNCTION MULTI CURRENCY-----------------------*/
$(function () {
    currency_rate()
})

function currency_rate() {
    if ($(".currency-unit").val() == undefined || $(".currency-unit").val() == 10) {
        console.log('no-unit')
    }else{
        var rate_unit = $(".rate-unit").val();
        var rate_cost = $(".rate-cost").val();
        var rate_floatdigit = $(".rate-floatdigit").val();
        var total = $(".total").val();
        var totalcom = $(".totalcom").val();
        var firstpay = $("#lastprice").text().replace(/,/g, '');
        var commisson = $(".commisson").val();
        if (rate_cost != 1 && rate_cost !='') {
            exchange_currency(rate_unit, rate_cost, rate_floatdigit, totalcom, 'totalcom');
            exchange_currency(rate_unit, rate_cost, rate_floatdigit, commisson, 'commisson');
            exchange_currency(rate_unit, rate_cost, rate_floatdigit, total, 'total');
            exchange_currency(rate_unit, rate_cost, rate_floatdigit, firstpay, 'firstpay');
        }
    }
}

function exchange_currency(rate_unit, rate_cost, rate_floatdigit, price, element) {
    $("." + `${element}` + "-section").find(".currency-section").remove()
    var exchange_currency = 0;
    if (rate_floatdigit == '') {
        exchange_currency = price * rate_cost;
    } else {
        let toString_element = (price * rate_cost).toString();
        if (toString_element.indexOf('.') > -1) {
            let parseFloat_element = parseFloat(toString_element).toFixed(rate_floatdigit).toString();
            let parseFloat_element_split = parseFloat_element.split('.');
            if (parseFloat_element_split[1].indexOf('0') > -1) {
                exchange_currency = parseFloat(price * rate_cost).toFixed(1).toString();
            } else {
                exchange_currency = parseFloat(price * rate_cost).toFixed(rate_floatdigit).toString();
            }
        } else {
            exchange_currency = parseFloat(price * rate_cost).toFixed(rate_floatdigit).toString();
        }
    }

    $("." + `${element}` + "-section").append(`<div class="currency-section"><span class="equal">==</span><span>${new Intl.NumberFormat().format(exchange_currency)}</span><span class="rate_unit">${rate_unit}</span></div>`)

}
/*------------------END FUNCTION MULTI CURRENCY-----------------------*/
$(".CloseBox").click(function () {
    $(".Details_box,#bg-popup,.popup-container").fadeOut("slow");
})

function onloadFunc() {
    var counter = 780;
    setInterval(function () {
        counter--;
        var m = parseInt(counter / 60);
        var s = counter % 60;
        if (counter >= 0) {
            span = document.getElementById("count");
            if (s < 10) {
                s = "0" + s;
            }
            if (m < 10) {
                m = "0" + m;
            }
            if (m < 2) {
                document.getElementById("count").classList.add("blink_me")
            }
            span.innerHTML = "00:" + m + ":" + s;
        }
        if (counter === 0) {
            $(".boxalert,#bg-popup").fadeIn();
            $(".boxalert").css("top", "200px")
            clearInterval(counter);
        }
    }, 1000);
};

$(".more_details").click(function () {
    $(".Details_box,#bg-popup").fadeIn("slow");
    $('html,body').animate({
        scrollTop: $(".Details_box").offset().top -= 50
    }, 'slow');
})
/*-----------------------------------------*/
$("#detailsHotel").click(function () {
    $(this).addClass("active-titr")
    $("#ruleRoom").removeClass("active-titr")
    $(".Hotel_information").slideDown("slow");
    $(".RuleRoom_info").slideUp("slow");
})
/*-----------------------------------------*/
$("#ruleRoom").click(function () {
    $(this).addClass("active-titr")
    $("#detailsHotel").removeClass("active-titr")
    $(".RuleRoom_info").slideDown("slow");
    $(".Hotel_information").slideUp("slow");

})
/*-----------------------------------------*/
function ShowRoomRule(element) {
    $(element).closest(".RuleRoom_info").find(".loadingLog").show()
    var optionId = $(".optionId").val()
    var mainprovider = 0;
    if($(".mainprovider").val() !== '""'){
        mainprovider = $(".mainprovider").val();
    }
    $.ajax({
        type: "post",
        url: "/Client_Rule_Room.bc",
        data: {
            mainprovider: mainprovider,
            optionId: optionId
        },
        success: function (result) {
            $(element).closest(".RuleRoom_info").find(".loadingLog").hide()
            $(element).closest(".RuleRoom_info").find(".resultRoomRule").empty().html(result)
        }
    });
}



/*-----------------------------------------*/
$(".invoice_prev_level").click(function () {
    $('html,body').animate({
        scrollTop: $(".info_box_inner").offset().top -= 50
    }, 'slow');
    if($(".step_title").attr("data-services")==0){
            $(".step_title").find("span").html('<span>Buyer details</span><span class="step-title-fa unvisible"><span class="dash">-</span>Buyer counter information</span>');
            $("#shopper_box").slideDown("slow");
        }else{
            $(".step_title").find("span").text("Service and transfer");
            $("#hotel_services_box").slideDown("slow");
    }
    $("#invoice_box").slideUp("slow");
    $(".visited:last").find('.counter-steps').show()
    $(".visited:last").removeClass('visited');
    $(".visited:last").addClass('eminext');
    $.ajax({
        type: "POST",
        url: $(".checkcoupon").attr("action"),
        data: {
            price: "",
            },
            success: function (response) {
                $(".couponresult").html(response);
                $(".couponcode").val('')
            }
    });
})


var m = JSON.stringify([##cms.form.roomSearch##])
$(".roomnodata").val(m)

$(".cost").each(function () {
    $(this).text(new Intl.NumberFormat().format($(this).text()))
})

var mdate_dep = document.getElementsByClassName("mdate_dep");
for (var i = 0; i < mdate_dep.length; i++) {
    mdate_dep[0].setAttribute("class", "mainmdate_dep")
};

$(document).ready(function () {
    var useridshopper = $(".useridshopper").val()
    if (useridshopper != 0) {
        $(".loadhere").empty().append('<div id="fountainG"><div id="fountainG_1" class="fountainG"></div><div id="fountainG_2" class="fountainG"></div><div id="fountainG_3" class="fountainG"></div><div id="fountainG_4" class="fountainG"></div><div id="fountainG_5" class="fountainG"></div><div id="fountainG_6" class="fountainG"></div><div id="fountainG_7" class="fountainG"></div><div id="fountainG_8" class="fountainG"></div></div>').load("/Client_Shopper_en.bc?provider=[##cms.form.provider##]")
        $(".checkMemberPoint").load('/Test_Check_Member_Point_EN.bc')
    }
    $.ajax({
        type: "POST",
        url: "/Client_List_Banks_en.bc",
        data: {
            firstpay: "[##db.firstpay.Value##]",
            moneytype: $(".moneytypeInfo").val(),
        },
        success: function (response) {
            $("#Bank-list").html(response);
        }
    });
    //<!------PAYMENT BY CREDIT------->//
    if ($(".Credit_payment").val() == 1) {
        $.ajax({
            type: "POST",
            url: "/Client_Credit_Payment_EN.bc",
            data: {
                total_with_commission: $(".totalcom").val(),
                moneytype: $(".moneytypeInfo").val(),
            },
            success: function (response) {
                $("#Section-Credit-Payment").html(response);
            }
        });

    }
    //<!------PAYMENT BY CREDIT------->//
});
$(document).ready(function (t) {
var json = [##cms.form.roomSearch##];
var passengers_info = $(".passengers-info");
for (var i = 0; i < json.rooms.length; i++) {
          var ChildWBAges = ""
         var ChildWOAges = ""
        var InfantAges = ""
    var childcountandage = json.rooms[i].childcountandage
    var splitchildcountandage = childcountandage.split(',')
 
    for (var j = 1; j < splitchildcountandage.length; j++) {
        if (splitchildcountandage[j] > 2 && splitchildcountandage[j] <= 6) {
            ChildWOAges += splitchildcountandage[j] + ' years old';
        }else if (splitchildcountandage[j] > 6 && splitchildcountandage[j] <= 12) {
            ChildWBAges += splitchildcountandage[j] + ' years old';
        }else if (splitchildcountandage[j] >= 1 && splitchildcountandage[j] <= 2) {
            InfantAges += splitchildcountandage[j] + ' years old';
        }
    }
    $(passengers_info[i]).find(".with-bed").append(ChildWBAges);
    $(passengers_info[i]).find(".without-bed").append(ChildWOAges);
    $(passengers_info[i]).find(".is-infant").append(InfantAges);
}
})
    // for (var i = 0; i < json.rooms.length; i++) {
    //     var childcountandage = json.rooms[i].childcountandage
    //     var ChildWBAges = ""
    //     var ChildWOAges = ""
    //     var InfantAges = ""
    //     var adultcount = ""
    //     var adultPassenger = ""
    //     var splitchildcountandage = childcountandage.split(',')
    //     for (var j = 1; j < splitchildcountandage.length; j++) {
    //         if (splitchildcountandage[j] > 2 && splitchildcountandage[j] <= 6) {
    //             ChildWOAges = ChildWOAges += splitchildcountandage[j] + ','
    //         } else if (splitchildcountandage[j] > 6 && splitchildcountandage[j] <= 12) {
    //             ChildWBAges = ChildWBAges += splitchildcountandage[j] + ','
    //         } else if (splitchildcountandage[j] >= 1 && splitchildcountandage[j] <= 2) {
    //             InfantAges = InfantAges += splitchildcountandage[j] + ','
    //         }
    //     }
    //     console.log("ChildWOAges="+ChildWOAges)
    //     console.log("ChildWBAges="+ChildWBAges)
    //     console.log("InfantAges="+InfantAges)
    //     if (ChildWOAges == "" && InfantAges == "") {
    //         ChildWBAges = ChildWBAges.slice(0, -1)
    //     }
    //     if (InfantAges == "") {
    //         ChildWOAges = ChildWOAges.slice(0, -1)
    //     }
    //     InfantAges = InfantAges.slice(0, -1)
    //     var adultcount = json.rooms[i].adultcount
    //     for (var x = 0; x < adultcount; x++) {
    //         adultPassenger += '0,'
    //     }
    // }
//<!------FORM PASSENGERS------->//
var schema = [##db.form.result##]
for (var i = 0; i < schema.length; i++) {
    var num = i + 1
    var newDiv = document.createElement("div");
    newDiv.className = 'passengerInfo';
    var countroom = document.createElement("div");
    countroom.className = 'num-room';
    countroom.className += " childdiv";
    countroom.innerHTML = "<span> Room " + num + "</span>";
    newDiv.appendChild(countroom);
    for (var j = 0; j < schema[i].room.length; j++) {
        var title = schema[i].room[j].title;
        var newtitle = document.createElement("div");
        newtitle.className = 'rezerve-tlt';
        newtitle.innerHTML = "<span class='title-passenger'>" + title + "</span><span class='select_passenger_container'><span class='select_passenger' data-open='0' onclick='show_passengersList(this)'><i class='fa fa-user'></i> From former travelers</span></span><div class='clr'></div>";
        var newDiv2 = document.createElement("div");
        newDiv2.className = 'boxInfoes';
        newDiv2.className += " childdiv";
        var newDiv3 = document.createElement("div");
        newDiv3.className = 'infoes-passenger';
        for (var y = 0; y < schema[i].room[j].form.length; y++) {
            var type = schema[i].room[j].form[y].type;
            if (type == 128) {
                var innerDiv = document.createElement("div");
                innerDiv.className = 'box-infoes';
                var question = schema[i].room[j].form[y].question;
                var newlabel = document.createElement('label');
                newlabel.className = 'label';
                newlabel.innerHTML = "<span>" + question + "</span>";
                innerDiv.appendChild(newlabel);
                newDiv3.appendChild(innerDiv);
                var string = "<input ";
                for (var x = 0; x < schema[i].room[j].form[y].attrs.length; x++) {
                    if (question == 'name' || question == 'last name' || question == 'national code' || question == 'passport number') {
                        if (schema[i].room[j].form[y].attrs[x].attr.name !== 'autocomplete') {
                            string += schema[i].room[j].form[y].attrs[x].attr.name + '="' + schema[i].room[j].form[y].attrs[x].attr.value + '" '
                        }
                    } else {
                        string += schema[i].room[j].form[y].attrs[x].attr.name + '="' + schema[i].room[j].form[y].attrs[x].attr.value + '" '
                    }
                };
                string += ">";
                innerDiv.innerHTML += string;
            };
            if (type == 130) {
                var innerDiv = document.createElement("div");
                innerDiv.className = 'box-infoes';
                var question = schema[i].room[j].form[y].question;
                var newlabel = document.createElement('label');
                newlabel.className = 'label';
                newlabel.innerHTML = "<span>" + question + "</span>";
                innerDiv.appendChild(newlabel);
                newDiv3.appendChild(innerDiv);
                var string = "<input ";
                for (var x = 0; x < schema[i].room[j].form[y].attrs.length; x++) {
                    if (question == 'name' || question == 'last name' || question == 'national code' || question == 'passport number') {
                        if (schema[i].room[j].form[y].attrs[x].attr.name !== 'autocomplete') {
                            string += schema[i].room[j].form[y].attrs[x].attr.name + '="' + schema[i].room[j].form[y].attrs[x].attr.value + '" '
                        }
                    } else {
                        string += schema[i].room[j].form[y].attrs[x].attr.name + '="' + schema[i].room[j].form[y].attrs[x].attr.value + '" '
                    }
                };
                string += ">";
                innerDiv.innerHTML += string;
            };
            if (type == 140) {
                var innerDiv = document.createElement("div");
                innerDiv.className = 'box-infoes';
                var question = schema[i].room[j].form[y].question;
                var newlabel = document.createElement('label');
                newlabel.className = 'label';
                newlabel.innerHTML = "<span>" + question + "</span>";
                innerDiv.appendChild(newlabel);
                newDiv3.appendChild(innerDiv);
                var string = "<select ";
                for (var x = 0; x < schema[i].room[j].form[y].attrs.length; x++) {
                    string += schema[i].room[j].form[y].attrs[x].attr.name + '="' + schema[i].room[j].form[y].attrs[x].attr.value + '" '
                };
                string += ">";
                for (var z = 0; z < schema[i].room[j].form[y].values.length; z++) {
                    string += "<option value='" + schema[i].room[j].form[y].values[z].value.value + "'>" + schema[i].room[j].form[y].values[z].value.title + " </option>"
                };
                string += '</select>';
                innerDiv.innerHTML += string;
            };
        };
        newDiv2.appendChild(newtitle);
        newDiv2.appendChild(newDiv3);
        newDiv.appendChild(newDiv2);
    }
    document.getElementById('passengers').appendChild(newDiv);

    $(".arraytel").each(function () {
        $(this).parent(".box-infoes").hide()
    })

    $(".E-mail").each(function () {
        $(this).parent(".box-infoes").hide()
    })

}

$(".passexpiredate").each(function () {
    $(this).attr("id", "")
});
$(".birthday").each(function () {
    $(this).attr("id", "")
});

//<!------END FORM PASSENGERS------->//
//<!------START PASSENGERS LIST------->//
function show_passengersList(element) {
    if ($(".mainuserid").val() == 0) {
        $(".loginpartner_frm").find(".passengerList-key").val(1)
        $(".loginpartner_frm").find(".dmnid-key").val('[##cms.cms.domainid##]')
        $(".loginpartner_frm").find(".internal-key").val($(".internal").val())
        $(".loginpartner_frm").find(".index-key").val($(element).closest(".passengerInfo").index() + "," + $(element).closest(".childdiv").index());
        check_reset_login();
    } else {
        if ($(element).attr("data-open") == 0) {
            $(element).attr("data-open", "1")
            $(element).closest(".childdiv").siblings(".childdiv").find(".select_passenger").attr("data-open", "1")
            $(element).closest(".passengerInfo").siblings(".passengerInfo").find(".select_passenger").attr("data-open", "1")
            load_passengersList('[##cms.cms.domainid##]', $(".mainuserid").val(), $(".internal").val(), $(element).closest(".passengerInfo").index() + "," + $(element).closest(".childdiv").index())
        } else {
            $(".select_passnger").each(function () {
                $(this).attr("data-index", $(element).closest(".passengerInfo").index() + "," + $(element).closest(".childdiv").index())
            })
            $(".bg-PassengersList").show()
            $(".PassengersList-container").show()
        }

    }

}
//<!------START PASSENGERS LIST------->//
$("#tarlink").click(function () {
    $("#bg-popup,.popup-container").show()
    $(".popup-container_content").empty().append('<div id="fountainG"><div id="fountainG_1" class="fountainG"></div><div id="fountainG_2" class="fountainG"></div><div id="fountainG_3" class="fountainG"></div><div id="fountainG_4" class="fountainG"></div><div id="fountainG_5" class="fountainG"></div><div id="fountainG_6" class="fountainG"></div><div id="fountainG_7" class="fountainG"></div><div id="fountainG_8" class="fountainG"></div></div>').load("/Get_Company_Rules_en.bc")
})
$("#finalforminvoice").each(function () {
    var val4 = ""
    $(this).find(".passengerInfo").each(function () {
        var s = $(this).find('input[type="hidden"]').val();
        val4 = val4 + '"' + s + '",';
    });
    val4 = val4.slice(0, -1);
    $(this).find(".roomidmain").val(val4)

});



$("#infovalidate").click(function () {
    var isValid = true;
    var json = [##cms.form.roomSearch##];
    var mainmdate_dep = $(this).closest(".rsv_box").find(".mainmdate_dep").val()
    for (var i = 0; i < json.rooms.length; i++) {
        var childcountandage = json.rooms[i].childcountandage
        var ChildWBAges = ""
        var ChildWOAges = ""
        var InfantAges = ""
        var adultcount = ""
        var adultPassenger = ""
        var splitchildcountandage = childcountandage.split(',')
        for (var j = 1; j < splitchildcountandage.length; j++) {
            if (splitchildcountandage[j] > 2 && splitchildcountandage[j] <= 6) {
                ChildWOAges = ChildWOAges += splitchildcountandage[j] + ','
            } else if (splitchildcountandage[j] > 6 && splitchildcountandage[j] <= 12) {
                ChildWBAges = ChildWBAges += splitchildcountandage[j] + ','
            } else if (splitchildcountandage[j] >= 1 && splitchildcountandage[j] <= 2) {
                InfantAges = InfantAges += splitchildcountandage[j] + ','
            }
        }
        if (ChildWOAges == "" && InfantAges == "") {
            ChildWBAges = ChildWBAges.slice(0, -1)
        }
        if (InfantAges == "") {
            ChildWOAges = ChildWOAges.slice(0, -1)
        }
        InfantAges = InfantAges.slice(0, -1)
        var adultcount = json.rooms[i].adultcount
        for (var x = 0; x < adultcount; x++) {
            adultPassenger += '0,'
        }

        var AgePassengerFinal = adultPassenger + ChildWBAges + ChildWOAges + InfantAges
        var splitAgePassengerFinal = AgePassengerFinal.split(',')
        var lenAge = AgePassengerFinal.split(',').length
        for (var y = 0; y < lenAge; y++) {
            var z = y + 2
            var m = i + 1
            if (splitAgePassengerFinal[y] > 0) {
                var birthdate = $("#passengers .passengerInfo:nth-child(" + m + ") .childdiv:nth-child(" + z + ")").find('.birthday').val();
                if(birthdate !== undefined){
                var dateSplitted = birthdate.split('-')
                var dateSplitted1 = dateSplitted[0]
                if (dateSplitted1 < 1900) {
                    if (dateSplitted1.indexOf('13') > -1) {
                        jD_date = PersianDate.PersianToGregorian(dateSplitted[0], dateSplitted[1], dateSplitted[2]);
                        jResult_date = jD_date[0] + "-" + jD_date[1] + "-" + jD_date[2];
                        $("#passengers .passengerInfo:nth-child(" + m + ") .childdiv:nth-child(" + z + ")").find('.birthday').val(jResult_date)
                    } else if (dateSplitted1.indexOf('14') > -1) {
                        jD_date = PersianDate.PersianToGregorian(dateSplitted[0], dateSplitted[1], dateSplitted[2]);
                        jResult_date = jD_date[0] + "-" + jD_date[1] + "-" + jD_date[2];
                        $("#passengers .passengerInfo:nth-child(" + m + ") .childdiv:nth-child(" + z + ")").find('.birthday').val(jResult_date)
                    } else if (dateSplitted1.indexOf('12') > -1) {
                        jD_date = PersianDate.PersianToGregorian(dateSplitted[0], dateSplitted[1], dateSplitted[2]);
                        jResult_date = jD_date[0] + "-" + jD_date[1] + "-" + jD_date[2];
                        $("#passengers .passengerInfo:nth-child(" + m + ") .childdiv:nth-child(" + z + ")").find('.birthday').val(jResult_date)
                    }
                }
                var new_birthdate = $("#passengers .passengerInfo:nth-child(" + m + ") .childdiv:nth-child(" + z + ")").find('.birthday').val();
                var newStr = new_birthdate.replace(/-/g, '');
                //var cms = "[##cms.cms.date2##]"
                var cms = mainmdate_dep.replace(/-/g, '')
                var newdate = (parseInt(cms) - parseInt(newStr)) / 10000

                if (newdate <= parseInt(splitAgePassengerFinal[y]) && newdate > parseInt(splitAgePassengerFinal[y] - 1)) {
                    $("#passengers .passengerInfo:nth-child(" + m + ") .childdiv:nth-child(" + z + ")").find(".birthday").parent().find(".AlertValidate").remove()
                } else {
                    isValid = false;
                    $("#passengers .passengerInfo:nth-child(" + m + ") .childdiv:nth-child(" + z + ")").find(".birthday").parent().find(".AlertValidate").remove()
                    $("#passengers .passengerInfo:nth-child(" + m + ") .childdiv:nth-child(" + z + ")").find(".birthday").parent().append('<p class="AlertValidate">(The child should be between  ' + parseInt(splitAgePassengerFinal[y] - 1) + ' and ' + splitAgePassengerFinal[y] + ' years old)</p>');
                }
            }
            }

        }

    }
    $(this).closest(".rsv_box").find("#passengers").find(".infoes-passenger").each(function () {
        $(this).find(".NationalCode").addClass('ValidateNationalCode')
        $(this).find(".passportcode").addClass('ValidatePassportCode')
        var valCountryid = $(this).find(".CountryidNationality").val()
        if (valCountryid == '1002236') {
            $(this).find(".NationalCode").addClass('ValidateNationalCode')
            $(this).find(".NationalCode").addClass('necessary')
            $(this).find(".NationalCode").removeClass('NoNatinalCode')
            $(this).find(".passportcode").addClass('ValidatePassportCode')
        } else {
            $(this).find(".NationalCode").removeClass('ValidateNationalCode')
            $(this).find(".NationalCode").addClass('NoNatinalCode')
            $(this).find(".passportcode").removeClass('ValidatePassportCode')
        }
        $(this).find(".datepicker").each(function () {
            var myDate = $(this).val()
            var dateSplitted = myDate.split('-')
            var dateSplitted1 = dateSplitted[0]
            if (dateSplitted1 < 1900) {
                if (dateSplitted1.indexOf('13') > -1) {
                    jD = PersianDate.PersianToGregorian(dateSplitted[0], dateSplitted[1], dateSplitted[2]);
                    jResult = jD[0] + "-" + jD[1] + "-" + jD[2];
                    $(this).val(jResult)
                } else if (dateSplitted1.indexOf('14') > -1) {
                    jD = PersianDate.PersianToGregorian(dateSplitted[0], dateSplitted[1], dateSplitted[2]);
                    jResult = jD[0] + "-" + jD[1] + "-" + jD[2];
                    $(this).val(jResult)
                } else if (dateSplitted1.indexOf('12') > -1) {
                    jD = PersianDate.PersianToGregorian(dateSplitted[0], dateSplitted[1], dateSplitted[2]);
                    jResult = jD[0] + "-" + jD[1] + "-" + jD[2];
                    $(this).val(jResult)
                }
            }
        })
        var brth = $(this).find(".datepicker").val();
        var typepass = $(this).find(".type").val();
        var birthfield = $(this).find(".birthday").val();
        var birthdate = new Date(brth)
        var cms = "[##cms.cms.date##]"
        var a = ""
        var type = typepass
        cms.split("/").forEach(function (x) {
            x.length >= 2 ? a += x : a += ("0" + x)
            a += "-"
        })
        a = a.substr(0, a.length - 1)
        date = a.split("-")
        date = date[2] + "-" + date[0] + "-" + date[1]
        var currentDate = new Date(date)
        var timeDiff = currentDate.getTime() - birthdate.getTime();
        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));
        tmp = (Math.floor(diffDays / 365))
        if (type == "2") {
            if (tmp < 12 || tmp > 98 || birthfield == '') {
                isValid = false;
                $(this).find(".alertvalid").remove()
                $(this).find(".birthday").after('<p class="alertvalid"> Enter a valid date for Adult</p>');
            } else {

                $(this).find(".box-infoes").find(".alertvalid").remove()

            }
        }
    });
    $(this).closest(".rsv_box").find("#passengers").find(".infoes-passenger").find(".box-infoes").each(function () {
        $(this).find(".necessary").each(function () {
            if ($(this).val() == "" && $(this).val().length < 1) {
                $(this).closest(".box-infoes").find(".alertvalid").remove()
                $(this).closest(".box-infoes").find(".necessary").after('<p class="alertvalid">Please complete the field</p>')
                isValid = false;
            } else {
                $(this).closest(".box-infoes").find(".alertvalid").remove()
            }
        });
        $(this).find(".ValidatePassportCode").filter(function () {
            var val = $(this).val();
            var reg = /^[a-zA-Z]{1}[0-9]{8}$/;
            if (!reg.test(val)) {
                $(this).closest(".box-infoes").find(".alertvalid").remove()
                $(this).closest(".box-infoes").find("input").after('<p class="alertvalid">Please enter as example (J12345678).</p>')
                isValid = false;
            } else {
                $(this).closest(".box-infoes").find(".alertvalid").remove()
            }
        });
        $(this).find(".ValidateNationalCode").filter(function () {
            var val = $(this).val();
            var reg = /^[0-9]{10}$/;
            if (!reg.test(val)) {
                $(this).closest(".box-infoes").find(".alertvalid").remove()
                $(this).closest(".box-infoes").find("input").after('<p  class="alertvalid">Please enter as example (0012345678).</p>')
                isValid = false;
            } else {
                $(this).closest(".box-infoes").find(".alertvalid").remove()
            }
        });
        $(this).find(".english").filter(function () {
            var val = $(this).val();
            var len = $(this).val().length;
            var reg = /^[a-zA-Z _]+$/;

            if (!reg.test(val)) {
                if ('[##db.country_name.Value##]' !== 'Iran') {
                    $(this).closest(".box-infoes").find(".alertvalid").remove()
                    $(this).closest(".box-infoes").find("input").after('<p  class="alertvalid">Please type in English.</p>')
                    isValid = false;
                }
            } else if (len < 2) {
                $(this).closest(".box-infoes").find(".alertvalid").remove()
                $(this).closest(".box-infoes").find("input").after('<p  class="alertvalid">The minimum number of characters is 2.</p>')
                isValid = false;

            } else {
                $(this).closest(".box-infoes").find(".alertvalid").remove()
            }
        })

        $(this).find(".NationalCode").each(function () {
            var keyval = $(this).val()
            if (isPersian(keyval)) {
                $(this).closest(".box-infoes").find(".alertvalid").remove()
                $(this).closest(".box-infoes").find("input").after('<p  class="alertvalid">Please type in English.</p>')
                isValid = false;
            }

            function isPersian(key) {
                var p = /^[\u0600-\u06FF\s]+$/;
                return p.test(key) && key != ' ';
            }
        });

        $(this).find(".passportcode").each(function () {
            var keyval = $(this).val()
            if (isPersian(keyval)) {
                $(this).closest(".box-infoes").find(".alertvalid").remove()
                $(this).closest(".box-infoes").find("input").after('<p  class="alertvalid">Please type in English.</p>')
                isValid = false;
            }

            function isPersian(key) {
                var p = /^[\u0600-\u06FF\s]+$/;
                return p.test(key) && key != ' ';
            }
        });

    });

    if (isValid == false) {
        $(".alert-tlt").empty().append('<p class="alertvalid">Please complete the required items correctly !</p>')
        $('html,body').animate({
            scrollTop: $(".alert-tlt").offset().top -= 50
        }, 'slow');
    }


    if (isValid) {
        $(this).attr("data-validate", "1")
        $(".alert-tlt").empty();
        var userid = $(".mainuserid").val();
        if ($(this).hasClass("next_level_notlog") && userid == 0) {
            $(".loginpartner_frm").find(".passengerList-key").val('');
            check_reset_login();
        } else {
            $('html,body').animate({
                scrollTop: $(".info_box_inner").offset().top -= 50
            }, 'slow');
            $("#passenger_box").slideUp("slow");
            $("#shopper_box").slideDown("slow");
            $(".step_title").html('<span>Buyer details</span><span class="step-title-fa unvisible"><span class="dash">-</span>Buyer counter information</span>');
            $(".visited:last").next().find('.counter-steps').hide();
            $(".visited:last").next().children('em').removeClass('eminext');
            $(".visited:last").next().addClass('visited').next().children('em').addClass("eminext");
            load_hotel_services();
        }

        var html = ""
        var htmlhead = ""
        $("#passengers").children(".passengerInfo:nth-child(1)").children(".childdiv:nth-child(2)").find(".box-infoes").each(function () {
            var label = $(this).find(".label").text()
            if (label.indexOf('phone') < 0 && label != 'roomid' && label != 'type') {
                htmlhead = htmlhead + "<div class='pass-col labeltbl'>" + label + "</div>";
            }
        });
        html = html + "<div class='pass-head-row pass-info-row'>" + htmlhead + "</div>";
        $("#passengers").find(".infoes-passenger").each(function () {
            var html2 = ""
            $(this).find(".box-infoes").each(function () {
                var checklabel = $(this).find(".label").text()
                if (checklabel.indexOf('phone') < 0 && checklabel != 'roomid' && checklabel != 'type') {
                    var vall = $(this).find(":input:not([type=hidden])").val();
                    html2 = html2 + "<div class='pass-col columns' data-label='" + checklabel + "'>" + vall + "</div>"
                }

            });
            html = html + "<div class='rows pass-info-row'>" + html2 + "</div>";
        });
        $(".passengerInfoes").empty().append(html)
        $(".passengerInfoes").find(".rows").each(function () {
            $(this).find(".columns").each(function () {
                var txt = $(this).text();
                if (txt == 'undefined') {
                    $(this).remove()
                }
                if (txt == '1') {
                    $(this).text('Male')
                } else if (txt == '0') {
                    $(this).text('Female')
                }

            });
        });
    

    }

})

$(".english").each(function () {
    $(this).attr('maxlength', '41')
    if ('[##db.country_name.Value##]' !== 'Iran') {
        $(this).bind('keydown', function (event) {
            switch (event.keyCode) {
                case 8:
                case 9:
                case 13:
                case 37:
                case 38:
                case 39:
                case 40:
                    break;
                default:
                    var regex = new RegExp("^[a-zA-Z _]+$");;
                    var key = event.key;
                    if (!regex.test(key)) {
                        event.preventDefault();
                        $(this).closest(".box-infoes").find(".alertvalid").remove()
                        $(this).closest(".box-infoes").find("input").after('<p  class="alertvalid">Please type in English</p>')
                        return false;
                    } else {
                        $(this).closest(".box-infoes").find(".alertvalid").remove()
                    }
                    break;
            }

        });
        $(this).bind('keyup', function (event) {
            $(this).val($(this).val().toUpperCase());
        });
    }
});

/*start new datepicker*/
function getPassportExpiryDate() {
    return new Date();
}
var regional = "",
    isJalali = false;
if (regional == "fa") {
    isJalali = true;
}
$('.birthday').focus(function (e) {
    FDatepicker(this, {
        single: true,
        isJalali: isJalali,
        changeMonth: true,
        changeYear: true,
        minDate: "-100y",
        maxDate: $("#AdaultMaxDate").val(),
        yearRangeJalali: "1250:1500",
        yearRangeGregorian: "1900:2030",
        numberOfMonths: 1,
    });
    var innerContent = $('.nice-select > ul');
    var option_height = $('.nice-select .option').height();
    var option_count = $('.nice-select .option').length;
    var Ul_height = parseInt(option_height) * parseInt(option_count)
    innerContent.scrollTop(Ul_height / 2);
});
$('.passexpiredate').focus(function (e) {
    FDatepicker(this, {
        single: true,
        isJalali: isJalali,
        changeMonth: true,
        changeYear: true,
        minDate: getPassportExpiryDate(),
        maxDate: '+15y',
        yearRangeJalali: "1250:1500",
        yearRangeGregorian: "1900:2150",
        numberOfMonths: 1,
    });
    var innerContent = $('.nice-select > ul');
    innerContent.scrollTop(0);
});
PersianDate = {
    g_days_in_month: [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31],
    j_days_in_month: [31, 31, 31, 31, 31, 31, 30, 30, 30, 30, 30, 29]
};
PersianDate.PersianToGregorian = function (j_y, j_m, j_d) {
    j_y = parseInt(j_y);
    j_m = parseInt(j_m);
    j_d = parseInt(j_d);
    var jy = j_y - 979;
    var jm = j_m - 1;
    var jd = j_d - 1;

    var j_day_no = 365 * jy + parseInt(jy / 33) * 8 + parseInt((jy % 33 + 3) / 4);
    for (var i = 0; i < jm; ++i) j_day_no += PersianDate.j_days_in_month[i];
    j_day_no += jd;
    var g_day_no = j_day_no + 79;
    var gy = 1600 + 400 * parseInt(g_day_no / 146097); /* 146097 = 365*400 + 400/4 - 400/100 + 400/400 */
    g_day_no = g_day_no % 146097;
    var leap = true;
    if (g_day_no >= 36525) /* 36525 = 365*100 + 100/4 */ {
        g_day_no--;
        gy += 100 * parseInt(g_day_no / 36524); /* 36524 = 365*100 + 100/4 - 100/100 */
        g_day_no = g_day_no % 36524;

        if (g_day_no >= 365) g_day_no++;
        else leap = false;
    }

    gy += 4 * parseInt(g_day_no / 1461); /* 1461 = 365*4 + 4/4 */
    g_day_no %= 1461;
    if (g_day_no >= 366) {
        leap = false;
        g_day_no--;
        gy += parseInt(g_day_no / 365);
        g_day_no = g_day_no % 365;
    }
    for (var i = 0; g_day_no >= PersianDate.g_days_in_month[i] + (i == 1 && leap); i++)
        g_day_no -= PersianDate.g_days_in_month[i] + (i == 1 && leap);
    var gm = i + 1;
    var gd = g_day_no + 1;
    gm = gm < 10 ? "0" + gm : gm;
    gd = gd < 10 ? "0" + gd : gd;
    return [gy, gm, gd];
}
/*end new datepicker*/

$(".showbank").click(function (e) {
    var isValid = true;
    var check = $(this).closest(".rsv_box").find(".rullcheck").prop('checked');
    var counter = $(this).closest(".rsv_box").find(".selectagcounter").val()
    if (check == false) {
        isValid = false;
        $(this).closest(".rsv_box").find(".alertcheck").show()
    } else {
        $(this).closest(".rsv_box").find(".alertcheck").hide()
    }
    if (counter == '0') {
        isValid = false;
        $(this).closest(".rsv_box").find(".alertcheck2").show()
    } else {
        $(this).closest(".rsv_box").find(".alertcheck2").hide()
    }
    if (isValid) {
        $('html,body').animate({
            scrollTop: $(".onlinepayment").offset().top -= 50
        }, 500);
        $(this).closest(".rsv_box").find(".onlinepayment").show()
    }

});

$(".onlinepayment").click(function () {
    $(".invoicedesc").val($(".invoice_note").val())
    $(".paytype").val($(this).attr('data-pay'))
    $(".clear").val($(this).attr('data-clear'))
    if ($(this).attr('data-clicked') == 0) {
        $(this).attr('data-clicked', '1')
        if($(".bank_id").val() == '71'){
        $.ajax({
        url: $("#finalforminvoice").attr("action"),
        type: $("#finalforminvoice").attr("method"),
        data: $($("#finalforminvoice")).serialize(),
        success: function (response) {
           $(".invoice_box_final").append(response);
        }
       });
        }else{
            $("#finalforminvoice").submit();
        }
        if ($(this).attr('data-clear') == 6) {
            $(this).closest(".redirectBank").find(".wait_credit").show()
            $("#Bank-list").attr('data-clicked', '1')
            $("#Bank-list").css('cursor', 'no-drop')
        } else {
            $(this).closest(".redirectBank").find(".wait_bank").show()
            $("#Section-Credit-Payment").attr('data-clicked', '1')
            $("#Section-Credit-Payment").css('cursor', 'no-drop')
        }
        $(this).css('cursor', 'no-drop')
    } else {
        $(this).css('cursor', 'no-drop')
    }
})

$(".hidebank").click(function (e) {
    var isValid = true;
    var check = $(this).closest(".rsv_box").find(".rullcheck").prop('checked');
    if (check == false) {
        isValid = false;
        $(this).closest(".rsv_box").find(".alertcheck").show()
    } else {
        $(this).closest(".rsv_box").find(".alertcheck").hide()
    }

    if (isValid) {
        $(this).closest(".rsv_box").find(".formaccounting").show()
    }
});

$(".reserve_reisze").each(function () {
    var sa = $(this).find(".moneytypeInfo").val()
    $(this).find(".moneytype").each(function () {
        $(this).text(sa)
    });
});

$(".formaccounting").click(function () {
    $(".invoicedesc").val($(".invoice_note").val())
    if ($(this).attr('data-clicked') == 0) {
        $(this).attr('data-clicked', '1')
        $("#finalforminvoice").submit()
        $(this).closest(".noBank").find(".waiting_text").show()
        $(this).css('cursor', 'no-drop')
    } else {
        $(this).css('cursor', 'no-drop')
    }
});

$(".passengerInfo").each(function () {
    $(this).find(".box-infoes").each(function () {
        $(this).find('input[type="hidden"]').parent(".box-infoes").hide()
    });
});

$(".addcommission").submit(function (e) {
    e.preventDefault()
    $.ajax({
        url: $(".addcommission").attr("action"),
        type: $(".addcommission").attr("method"),
        data: $($(".addcommission")).serialize(),
        success: function (response) {
            $('.comInfo').empty().show().html(response);
            var com = $(".commission").val();
            var tltcom = $(".totalwithcom").val();
            var Ftlt = $(".totalfirstpay").val();
            //<!------PAYMENT BY CREDIT------->//
            if ($(".Credit_payment_new").val() == 1) {
                $.ajax({
                    type: "POST",
                    url: "/Client_Credit_Payment_EN.bc",
                    data: {
                        total_with_commission: $(".totalwithcom").val(),
                        moneytype: $(".moneytypeInfo").val(),
                    },
                    success: function (response) {
                        $("#Section-Credit-Payment").html(response);
                    }
                });

            }
            //<!------PAYMENT BY CREDIT------->//
            if (tltcom !== Ftlt) {
                $(".allcost01").text('First stage payment')
                $(".step-payment").val('1')
            }
            if ($(".commission").val() && com != 0) {
                $(".commissionresize").show()
                $(".totalcomresize").show()
                $(".commissonCount").text(com)
                $(".commisson").val(com)
                $(".commissonCount").each(function () {
                    $(this).text(new Intl.NumberFormat().format($(this).text()))
                })
            }
            if ($(".totalwithcom").val()) {
                $(".finaltotalcom").text(tltcom);
                $(".totalcom").val(tltcom);
                $(".finaltotalcom").each(function () {
                    $(this).text(new Intl.NumberFormat().format($(this).text()))
                })
            }
            if ($(".totalfirstpay").val()) {
                $(".finalprice").each(function () {
                    $(this).text(Ftlt);
                    $(this).text(new Intl.NumberFormat().format($(this).text()))
                })
                $(".price_firstpay").val(Ftlt);

            }
            /*------------------START FUNCTION MULTI CURRENCY-----------------------*/
            currency_rate()
            /*------------------END FUNCTION MULTI CURRENCY-----------------------*/
            load_hotel_services();

        }
    });
});

if ($(".commissonCount").text() != 0) {
    $(".totalcomresize").show()
}
if ($(".totalcom").val() !== $(".price_firstpay").val()) {
    $(".allcost01").text('First stage payment')
    $(".step-payment").val('1')
}
/*------------------START FUNCTION CHECK COUNTRY OWNER-----------------------*/
fetch('/Client_CountryId_Library.bc')
    .then(response => response.json())
    .then(data => {
        const country = data.filter((item) => item.dmnid == '[##cms.cms.domainid##]').map((item) => item.country);
        const country_id = data.filter((item) => item.dmnid == '[##cms.cms.domainid##]').map((item) => item.country_id);
        if (country.length > 0) {
            $(".box-infoes").find(".autocompleteCOUNTRY").each(function () {
                $(this).closest(".box-infoes").find(".countryInfo").val(country_id);
                $(this).val(country);
               $(this).closest(".boxInfoes").find(".NationalCode").addClass("ncode-notshow")
               $(this).closest(".boxInfoes").find(".ncode-notshow").removeClass("necessary")
               $(this).closest(".boxInfoes").find(".ncode-notshow").removeClass("NationalCode")
               $(this).closest(".boxInfoes").find(".ncode-notshow").parent(".box-infoes").hide()
               $(this).closest(".boxInfoes").find(".ncode-notshow").val('-')

            })
        } else {
            $(".box-infoes").find(".autocompleteCOUNTRY").each(function () {
                $(this).closest(".box-infoes").find(".countryInfo").val('1002236');
                $(this).val('Iran');
                if ($(".internal").val() == 1) {
                   $(this).closest(".boxInfoes").find(".passportcode").addClass("pass-notshow")
                   $(this).closest(".boxInfoes").find(".passexpiredate").addClass("passxp-notshow")
                   $(this).closest(".boxInfoes").find(".DrawerCo").addClass("drw-notshow")
                   $(this).closest(".boxInfoes").find(".pass-notshow").val("-")
                   $(this).closest(".boxInfoes").find(".passxp-notshow").val("-")
                   $(this).closest(".boxInfoes").find(".passportcode").parent(".box-infoes").hide()
                   $(this).closest(".boxInfoes").find(".passexpiredate").parent(".box-infoes").hide()
                   $(this).closest(".boxInfoes").find(".DrawerCo").parent(".box-infoes").hide()
                    var style = $(this).css('display');
                    if (style == 'none') {
                       $(this).closest(".boxInfoes").find(".necessary").removeClass("passexpiredate")
                       $(this).closest(".boxInfoes").find(".necessary").removeClass("passportcode")
                       $(this).closest(".boxInfoes").find(".necessary").removeClass("DrawerCo")
                       $(this).closest(".boxInfoes").find('input').removeClass("necessary")
                    }
                } else {
                   $(this).closest(".boxInfoes").find(".passportcode").addClass("ValidatePassportCode")
                   $(this).closest(".boxInfoes").find(".NationalCode").addClass("ValidateNationalCode")
                   $(this).closest(".boxInfoes").find(".DrawerCo").addClass("drw-notshow")
                   $(this).closest(".boxInfoes").find(".DrawerCo").parent(".box-infoes").hide()
                   $(this).closest(".boxInfoes").find(".drw-notshow").removeClass("DrawerCo")
                   $(this).closest(".boxInfoes").find('.drw-notshow').removeClass("necessary")
                }

            })
        }
    }).catch(error => console.error(error))


$(".passengerInfo").each(function () {
    $(this).find(".autocompleteCOUNTRY").each(function () {
        $(this).after('<span  class="mini-loading"><img src="/images/load.gif" width="20" height="20" /></span><input type="hidden" value="" name="countryInfo" class="countryInfo" /><div class="clr"></div><div class="co"></div>')
        $(this).closest(".box-infoes").find(".countryInfo").attr("name", $(this).attr("name"))
        $(this).closest(".box-infoes").addClass('c-infoo')
        $(this).attr("name", "")
        $(this).on('click', function (e) {
            $(this).val('')
            $(this).closest(".box-infoes").find(".countryInfo").val('')
            var namecountryInfo =  $(this).closest(".box-infoes").find(".countryInfo").attr("name")
            if (namecountryInfo.indexOf('nationality') > -1) {
               $(this).closest(".boxInfoes").find(".NationalCode").val('')
               $(this).closest(".boxInfoes").find(".passportcode").val('')
               $(this).closest(".boxInfoes").find(".passportcode").removeClass("ValidatePassportCode")
            }
        });
        var namecountryInfo =  $(this).closest(".box-infoes").find(".countryInfo").attr("name")
        if (namecountryInfo.indexOf('nationality') > -1) {
            $(this).closest(".box-infoes").find(".countryInfo").addClass('CountryidNationality')
        }
    });
});

/*------------------END FUNCTION CHECK COUNTRY OWNER-----------------------*/


$(".indexRoom").each(function () {
    var m = $(this).text();
    if (m == 1) {
        $(this).text('First room')
    } else if (m == 2) {
        $(this).text('Second room')
    } else if (m == 3) {
        $(this).text('Third room')
    } else if (m == 4) {
        $(this).text('Fourth room')
    }
});

$(".checkcoupon").submit(function (e) {
    e.preventDefault(e)
    var accounttype = $(".accounttypetotal").val();
    var coupondata = $(".coupondata").val();
    var firstpay = $(".price_firstpay").attr("data-firstpay");
    var totalcom = $(".totalcom").val();
    var couponcode = $(".couponcode").val();
    var userid = $(".mainuserid").val();
    var transfer_for_coupon = $(".transfer-for-coupon").val()
    $(".CheckCoupon-loading").show()
    $.ajax({
        type: "POST",
        url: $(".checkcoupon").attr("action"),
        data: {
            accounttype: accounttype,
            price: totalcom,
            firstpay: firstpay,
            schemaid: 251,
            provider: "[##cms.form.provider##]",
            coupondata: coupondata,
            couponcode: couponcode,
            userid: userid,
            transfer_for_coupon:transfer_for_coupon

        },
        success: function (response) {
            $(".couponresult").html(response);
            $(".CheckCoupon-loading").hide();
            /*------------------START FUNCTION MULTI CURRENCY-----------------------*/
            currency_rate()
            /*------------------END FUNCTION MULTI CURRENCY-----------------------*/
        }
    });
});

function empty(a) {
    $(a).val('')
    $(a).closest(".c-infoo").find(".countryInfo").val('')
}

$('.country').each(function (e) {
    $(this).on('input', function () {
        var _this = this;
        if (e.which !== 0 && !e.ctrlKey && !e.metaKey && !e.altKey) {
            upper_case = $(this).val().substr(0, 1).toUpperCase() + $(this).val().substr(1).toLowerCase();
            $(this).val(upper_case)
            if ($(this).val().length > 2) {
                $(this).closest(".c-infoo").find(".mini-loading").show();
                $.ajax({
                    url: '/Client_Get_Country.bc',
                    type: 'get',
                    data: {
                        key: $(this).val(),
                        internal: $(".internal").val(),
                        module_type :"en"
                    },
                    success: function (result) {
                        $(_this).closest(".c-infoo").find(".mini-loading").hide();
                        $(_this).closest(".c-infoo").find(".co").empty().html(result)
                    }
                });
            } else
                $(_this).closest(".c-infoo").find(".co").empty()
        }
    });
    $(this).on('blur', function () {
        if ($(this).closest(".c-infoo").find(".co").text().length > 0) {
            if (hoverelse == 0) {
                var defresult = $(this).closest(".c-infoo").find(".co").children(".selectCountry:first").find(".txtcountry").text();
                var defresultid = $(this).closest(".c-infoo").find(".co").children(".selectCountry:first").find(".countryid").val();
                $(this).closest(".c-infoo").find(".country").val(defresult);
                $(this).closest(".c-infoo").find(".countryInfo").val(defresultid);
                var sval = $(this).closest(".c-infoo").find(".countryInfo").val()
                $(this).closest(".c-infoo").find(".co").empty();
                var idcountry = $(this).closest(".c-infoo").find(".CountryidNationality").val()
                var internal = $(".internal").val()
                if (internal == 0) {
                    if (idcountry !== '1002236' && idcountry !== undefined) {
                        // flight = external & passenger = not iranian
                       $(this).closest(".boxInfoes").find(".NationalCode").addClass("ncode-notshow")
                       $(this).closest(".boxInfoes").find(".drw-notshow").addClass("DrawerCo")
                       $(this).closest(".boxInfoes").find(".DrawerCo").addClass("necessary")
                       $(this).closest(".boxInfoes").find(".DrawerCo").removeClass("drw-notshow")
                       $(this).closest(".boxInfoes").find(".ncode-notshow").removeClass("necessary")
                       $(this).closest(".boxInfoes").find(".ncode-notshow").removeClass("NationalCode")
                       $(this).closest(".boxInfoes").find(".ncode-notshow").removeClass("ValidateNationalCode")
                       $(this).closest(".boxInfoes").find(".ncode-notshow").parent(".box-infoes").css("display", "none")
                       $(this).closest(".boxInfoes").find(".ncode-notshow").val('-')
                       $(this).closest(".boxInfoes").find(".passportcode").removeClass("ValidatePassportCode")
                       $(this).closest(".boxInfoes").find(".DrawerCo").parent(".box-infoes").css("display", "block")
                       $(this).closest(".boxInfoes").find(".passportcode").closest(".box-infoes").find(".alertvalid").hide()
                       $(this).closest(".boxInfoes").find(".DrawerCo").val('')
                    } else if (idcountry == '1002236' && idcountry !== undefined) {
                        // flight = external & passenger = iranian
                       $(this).closest(".boxInfoes").find(".DrawerCo").addClass("drw-notshow")
                       $(this).closest(".boxInfoes").find(".ncode-notshow").addClass("necessary")
                        $(this).closest(".boxInfoes").find(".ncode-notshow").addClass("NationalCode")
                        $(this).closest(".boxInfoes").find(".ncode-notshow").addClass("ValidateNationalCode")
                        $(this).closest(".boxInfoes").find(".passportcode").addClass("ValidatePassportCode")
                        $(this).closest(".boxInfoes").find(".DrawerCo").parent(".box-infoes").css("display", "none")
                        $(this).closest(".boxInfoes").find(".NationalCode").parent(".box-infoes").css("display", "block")
                        $(this).closest(".boxInfoes").find(".NationalCode").removeClass("ncode-notshow")
                        $(this).closest(".boxInfoes").find(".drw-notshow").removeClass("DrawerCo")
                        $(this).closest(".boxInfoes").find(".drw-notshow").removeClass("necessary")
  
                    }
                } else if (internal == 1) {
                    if (idcountry !== '1002236' && idcountry !== undefined) {
                        // flight = internal & passenger = not iranian
                        $(this).closest(".boxInfoes").find(".NationalCode").addClass("ncode-notshow")
                        $(this).closest(".boxInfoes").find(".pass-notshow").addClass("passportcode")
                        $(this).closest(".boxInfoes").find(".passxp-notshow").addClass("passexpiredate")
                        $(this).closest(".boxInfoes").find(".drw-notshow").addClass("DrawerCo")
  
                        $(this).closest(".boxInfoes").find(".passportcode").addClass("necessary")
                        $(this).closest(".boxInfoes").find(".passexpiredate").addClass("necessary")
                        $(this).closest(".boxInfoes").find(".DrawerCo").addClass("necessary")
  
                        $(this).closest(".boxInfoes").find(".passportcode").removeClass("pass-notshow")
                        $(this).closest(".boxInfoes").find(".passexpiredate").removeClass("passxp-notshow")
                        $(this).closest(".boxInfoes").find(".DrawerCo").removeClass("drw-notshow")
  
  
                        $(this).closest(".boxInfoes").find(".ncode-notshow").removeClass("necessary")
                        $(this).closest(".boxInfoes").find(".ncode-notshow").removeClass("NationalCode")
                        $(this).closest(".boxInfoes").find(".ncode-notshow").removeClass("ValidateNationalCode")
                        $(this).closest(".boxInfoes").find(".passportcode").closest(".box-infoes").find(".alertvalid").hide()
  
                        $(this).closest(".boxInfoes").find(".passportcode").val('')
                        $(this).closest(".boxInfoes").find(".passexpiredate").val('')
                        $(this).closest(".boxInfoes").find(".DrawerCo").val('')
  
  
                        $(this).closest(".boxInfoes").find(".passportcode").parent(".box-infoes").css("display", "block")
                        $(this).closest(".boxInfoes").find(".passexpiredate").parent(".box-infoes").css("display", "block")
                        $(this).closest(".boxInfoes").find(".DrawerCo").parent(".box-infoes").css("display", "block")
                        $(this).closest(".boxInfoes").find(".ncode-notshow").parent(".box-infoes").css("display", "none")
                        $(this).closest(".boxInfoes").find(".ncode-notshow").val('-')
                    } else if (idcountry == '1002236' && idcountry !== undefined) {
                        // flight = internal & passenger = iranian
  
                        $(this).closest(".boxInfoes").find(".ncode-notshow").addClass("necessary")
                        $(this).closest(".boxInfoes").find(".ncode-notshow").addClass("NationalCode")
                        $(this).closest(".boxInfoes").find(".ncode-notshow").removeClass("ValidateNationalCode")
                        $(this).closest(".boxInfoes").find(".passportcode").addClass("pass-notshow")
                        $(this).closest(".boxInfoes").find(".passexpiredate").addClass("passxp-notshow")
  
                        $(this).closest(".boxInfoes").find(".passportcode").val("-")
                        $(this).closest(".boxInfoes").find(".passexpiredate").val("-")
  
  
                        $(this).closest(".boxInfoes").find(".DrawerCo").addClass("drw-notshow")
  
                        $(this).closest(".boxInfoes").find(".NationalCode").removeClass("ncode-notshow")
                        $(this).closest(".boxInfoes").find(".passportcode").removeClass("necessary")
                        $(this).closest(".boxInfoes").find(".passexpiredate").removeClass("necessary")
                        $(this).closest(".boxInfoes").find(".DrawerCo").removeClass("necessary")
  
  
                        $(this).closest(".boxInfoes").find(".NationalCode").parent(".box-infoes").css("display", "block")
                        $(this).closest(".boxInfoes").find(".passportcode").parent(".box-infoes").css("display", "none")
                        $(this).closest(".boxInfoes").find(".passexpiredate").parent(".box-infoes").css("display", "none")
                        $(this).closest(".boxInfoes").find(".DrawerCo").parent(".box-infoes").css("display", "none")
  
                        $(this).closest(".boxInfoes").find(".pass-notshow").removeClass("passportcode")
                        $(this).closest(".boxInfoes").find(".passxp-notshow").removeClass("passexpiredate")
                        $(this).closest(".boxInfoes").find(".drw-notshow").removeClass("DrawerCo")
  
  
                     $(this).closest(".boxInfoes").find(".pass-notshow").val('-')
                     $(this).closest(".boxInfoes").find(".passxp-notshow").val('-')
                    }
                }
            }
        } else {
            $(this).closest(".c-infoo").find(".mini-loading").hide()
            $(this).closest(".c-infoo").find(".country").val('');
            $(this).closest(".c-infoo").find(".countryInfo").val('');
        }
    });
})

$(document).ready(function () {
    if($(".checkpreurl").val() !== ''){
        $(".hsearch").each(function () {
            $(this).attr('action', '/Test_Hotel_Search_EN.bc')
        })
      }
    if ($(window).width() <= 750) {
        $(".hsearch").each(function () {
            $(this).attr('action', '/M_Test_Hotel_Search_EN.bc')
        })
    }
})
//<!------STATR JS RESET LOGIN BOX------->
function check_reset_login() {
    if ($("#Login_box").length) {
        $("#Login_box,#bg-popup2").show();
        $(".Wrapper-registerinfo").hide()
        $(".Wrapper-logininfo").show()
        $(".Wrapper-forgetpass").hide()
        $(".Wrapper-resendmail").hide()
        $(".login-form_new").show()
        $(".login-form_prev").hide()
        $('html,body').animate({
            scrollTop: $("#Login_box").offset().top -= 50
        }, 500);
    } else {
        $(".not-login-section").click();
    }
    $(".error-login").each(function () {
        $(this).empty()
    })
    $(".fcapForgetpass,.fcap,.fcapRegMail,.fcapResendmail").each(function () {
        $(this).hide()
    })
    $(".login_info input:not([type=hidden]").each(function () {
        $(this).val('')
    })
}
//<!------END JS RESET LOGIN BOX------->
//<!------START HOTEL SERVICES------->//
function load_hotel_services() {
    if ($("#hotel_services_box").attr("data-open") == 1) {
        console.log("ok2")
        check_name_family();
    } else {
        console.log("ok3")
        var hotel_dmnid = 0; 
        if(document.querySelector(".hotel_dmnid")){
            hotel_dmnid = document.querySelector(".hotel_dmnid").value;
        }else{
            const obj = JSON.parse(document.querySelector(".mainprovider").value)
            hotel_dmnid = obj.dmnid
        }

        if (document.querySelector(".serviceid")) {
            $.ajax({
            type: "post",
            url: "/Test_Hotel_Services_EN.bc",
            data: {
                providerid: "[##cms.form.provider##]",
                dmnid: "[##cms.cms.domainid##]",
                cityid: "[##cms.form.cityid##]",
                fromdate: "[##cms.form.fdate##]",
                todate: "[##cms.form.tdate##]",
                passenger: '[##cms.form.roomSearch##]',
                supplier: '[##cms.form.supplier##]',
                serviceid: $(".serviceid").val(),
                hotel_name: $(".hotel-name").val(),
                step_payment: $(".step-payment").val(),
                userid: $(".mainuserid").val(),
                flight_mstring_dep: "[##cms.form.fdate##]",
                flight_mstring_des: "[##cms.form.tdate##]",
                hotel_dmnid: hotel_dmnid,
                FareSourceCode: FareSourceCode,
                extra_service: hotel_extra_service
           
            },
            success: function (response) {
                $("#hotel_services_box").html(response)
                $("#hotel_services_box").attr("data-open", "1")
                if($("#hotel_services_box").attr("data-transfer") == 0 && $("#hotel_services_box").attr("data-service") == 0){
                    console.log("yes")
                    $("#hotel_services_box").remove();
                    $(".hotel_services_info").remove();
                    $(".step_title").attr('data-services',"0");
                }else{
                    console.log("no")
                    $(".service-step").css("display","inline-block");
                }
            }
        }); 

        }
        else if(document.querySelector(".hotel_extra_service")){
            var check_provider = "[##cms.form.provider##]";
            if(check_provider == 82){
                var hotel_extra_service = true;
                const FareSourceCode_obj = JSON.parse(document.querySelector(".hotel_extra_service").value)
                var FareSourceCode = FareSourceCode_obj.id.FareSourceCode.transfer_options;
                $.ajax({
            type: "post",
            url: "/Test_Hotel_Services_EN.bc",
            data: {
                providerid: "[##cms.form.provider##]",
                dmnid: "[##cms.cms.domainid##]",
                cityid: "[##cms.form.cityid##]",
                fromdate: "[##cms.form.fdate##]",
                todate: "[##cms.form.tdate##]",
                passenger: '[##cms.form.roomSearch##]',
                supplier: '[##cms.form.supplier##]',
                serviceid: $(".serviceid").val(),
                hotel_name: $(".hotel-name").val(),
                step_payment: $(".step-payment").val(),
                userid: $(".mainuserid").val(),
                flight_mstring_dep: "[##cms.form.fdate##]",
                flight_mstring_des: "[##cms.form.tdate##]",
                hotel_dmnid: hotel_dmnid,
                FareSourceCode: FareSourceCode,
                extra_service: hotel_extra_service
           
            },
            success: function (response) {
                $("#hotel_services_box").html(response)
                $("#hotel_services_box").attr("data-open", "1")
                if($("#hotel_services_box").attr("data-transfer") == 0 && $("#hotel_services_box").attr("data-service") == 0){
                    console.log("yes")
                    $("#hotel_services_box").remove();
                    $(".hotel_services_info").remove();
                    $(".step_title").attr('data-services',"0");
                }else{
                    console.log("no")
                    $(".service-step").css("display","inline-block");
                }
            }
        }); 
            }
        }else {
            $("#hotel_services_box").remove();
            $(".hotel_services_info").remove();
            $(".step_title").attr('data-services',"0");
        }
   

    }
}
 //<!------END HOTEL SERVICES------->//
</script>
<!------REACT CODE FOR PASSENGERS LIST------->  
<script src="[##cms.cms.cdn##]/js/reservation_react.production.min.js" crossorigin></script>
<script src="[##cms.cms.cdn##]/js/reservation_react_dom.production.min.js" crossorigin></script>
<script src="[##cms.cms.cdn##]/js/reservation_babel.min.js" crossorigin></script>
<script src="[##cms.cms.cdn##]/js/reservation_react_paging.js"></script>
<script type="text/babel">
function load_passengersList(dmnid, userid, internal, index) {
    class App extends React.Component {
        constructor(props) {
            super(props);
            this.state = {
                data: [],
                library: null,
                perPage: 10,
                currentPage: 1,
                maxPage: null,
                filter: "",
                InternalOrExternal: ""

            };
        }
        componentDidMount() {
            if (internal == 0) {
                this.setState({ InternalOrExternal: 'Passport number' })
            } else {
                this.setState({ InternalOrExternal: 'National code' })
            }
            fetch("/Client_Passengers_List_Json.bc", {
                method: "POST",
                body: "dmnid=" + dmnid + "&userid=" + userid + "",
            })
                .then((response) => response.text())
                .then((text) => {
                    text = text.replace(/\"/g, '')
                    let Maindata = JSON.parse(text.replace(/\'/g, '"'));
                    this.setState(
                        (state) => ({
                            ...state,
                            data: Maindata,
                        }),
                        () => {
                            this.reorganiseLibrary();
                            $(".loading-passengerList").hide()
                            $(".section-passengersList").show()
                        }
                    );
                })
                .catch((error) => console.error(error));

        }
        componentDidUpdate() {
            $(".close_content").click(function () {
                $(".bg-PassengersList").hide()
                $(".PassengersList-container").hide()
            })
            $(".select_passnger").each(function () {
                $(this).click(function () {
                    $(".bg-PassengersList").hide()
                    $(".PassengersList-container").hide()
                    var data_firstname = $(this).attr("data-firstname")
                    var data_lastname = $(this).attr("data-lastname")
                    var data_nationalcode = $(this).attr("data-nationalcode")
                    var data_birthdate = $(this).attr("data-birthdate")
                    var data_gender = $(this).attr("data-gender")
                    var data_passportcode = $(this).attr("data-passportcode")
                    var data_passportexpiration = $(this).attr("data-passportexpiration")
                    var data_nationality = $(this).attr("data-nationality")
                    var data_nationality_name = $(this).attr("data-nationality_name")
                    var data_passportissuecountry = $(this).attr("data-passportissuecountry")
                    var data_type = $(this).attr("data-type")
                    var data_internal = $(this).attr("data-internal")
                    var data_index = $(this).attr("data-index")
                    var data_index_split = data_index.split(',')
                    var data_index_room = parseInt(data_index_split[0]) + 1
                    var data_index_passenger = parseInt(data_index_split[1]) + 1
                    var countryofresidence_id = ""
                    $("#passengers").children(".passengerInfo:nth-child(" + data_index_room + ")").children(".childdiv:nth-child(" + data_index_passenger + ")").each(function () {
                        if ($(this).find(".box-infoes select").attr("name").indexOf('gender') > -1) { $(this).find(".box-infoes select").val(data_gender) }
                        $(this).find(".box-infoes input[type=hidden]").each(function () {
                            if ($(this).attr("name").indexOf('nationality') > -1) {
                                $(this).val(data_nationality)
                                $(this).closest(".box-infoes").find(".country").val(data_nationality_name)
                                countryofresidence_id = $(this).val()
                            }
                        })
                        $(this).find(".box-infoes input[type=text]").each(function () {
                            if ($(this).attr("name").indexOf('firstname') > -1) { $(this).val(data_firstname) }
                            else if ($(this).attr("name").indexOf('lastname') > -1) { $(this).val(data_lastname) }
                            else if ($(this).attr("name").indexOf('birthdate') > -1 || $(this).attr("name").indexOf('birthday') > -1) { $(this).val(data_birthdate) }
                            else if ($(this).attr("name").indexOf('passportcode') > -1) {
                                if (countryofresidence_id !== '1002236') {
                                    $(this).removeClass("ValidatePassportCode")
                                    $(this).val(data_passportcode)
                                } else {
                                    if (data_internal == '0') {
                                        $(this).val(data_passportcode)
                                        $(this).addClass("ValidatePassportCode")
                                        $(this).closest(".box-infoes").show()
                                    } else {
                                        $(this).val('-')
                                        $(this).removeClass("ValidatePassportCode")
                                        $(this).closest(".box-infoes").hide()
                                    }
                                }

                            }
                            else if ($(this).attr("name").indexOf('passportexpiration') > -1) {
                                if (data_internal == '0') {
                                    $(this).val(data_passportexpiration)
                                } else {
                                    $(this).val('-')
                                }
                            }
                            else if ($(this).attr("name").indexOf('NationalCode') > -1 || $(this).attr("name").indexOf('nationalcode') > -1) {
                                if (countryofresidence_id !== '1002236') {
                                    $(this).removeClass("ValidateNationalCode")
                                    $(this).closest(".box-infoes").hide()
                                } else {
                                    if (data_internal == '0') {
                                        $(this).addClass("ValidateNationalCode")
                                        $(this).closest(".box-infoes").show()
                                    } else {
                                        $(this).addClass("ValidateNationalCode")
                                        $(this).closest(".box-infoes").show()
                                    }
                                }
                                $(this).val(data_nationalcode)
                            }
                        })
                    })
                })
            })
        }
        reorganiseLibrary = () => {
            const { filter, perPage, data } = this.state;
            let library = data;
            if (filter !== "") {
                library = library.filter(item =>
                    item.firstname.toLowerCase().includes(filter) || item.lastname.toLowerCase().includes(filter) || item.birthdate.toLowerCase().includes(filter) || item.passportcode.toLowerCase().includes(filter) || item.nationalcode.toLowerCase().includes(filter)
                )
            }
            library = _.chunk(library, perPage);
            this.setState({
                library,
                currentPage: 1,
                maxPage: library.length === 0 ? 1 : library.length,
            });
        };
        handleChange = evt =>
            this.setState(
                {
                    filter: evt.target.value.toLowerCase()
                },
                () => {
                    this.reorganiseLibrary();
                }
            )
        // Previous Page
        previousPage = (event) => {
            this.setState({
                currentPage: this.state.currentPage - 1,
            });
        };

        // Next Page
        nextPage = (event) => {
            this.setState({
                currentPage: this.state.currentPage + 1,
            });
        };

        // handle per page
        handlePerPage = (evt) =>
            this.setState(
                {
                    perPage: evt.target.value,
                },
                () => this.reorganiseLibrary()
            );

        // handle render of library
        renderLibrary = () => {
            const { library, currentPage } = this.state;
            if (!library || (library && library.length === 0)) {
                return (
                    <div className="nodata passenger-list-row">
                        <div className="passenger-list-col"> No results found!</div>
                    </div>
                );
            }
            return library[currentPage - 1].map((item, i) => (
                <div className="passenger-list-row">
                    <div className="passenger-list-col" data-label={this.renderInternal_label(item)}>{this.renderInternal(item)}</div>
                    <div className="passenger-list-col" data-label="Full name">{item.firstname} {item.lastname}</div>
                    <div className="passenger-list-col" data-label="Birthdate">{item.birthdate}</div>
                    <div className="passenger-list-col" data-label="-"><button className="select_passnger" data-firstname={item.firstname}
                        data-lastname={item.lastname}
                        data-nationalcode={item.nationalcode}
                        data-birthdate={item.birthdate}
                        data-gender={item.gender}
                        data-passportcode={item.passportcode}
                        data-passportexpiration={item.passportexpiration}
                        data-type={item.type}
                        data-nationality={item.countryofresidence.countryid}
                        data-nationality_name={item.countryofresidence.ecountryname}
                        data-passportissuecountry={item.passportissuecountry}
                        data-index={index}
                        data-internal={internal}
                    >Choose</button></div>
                </div>
            ));
        };

        render() {
            const { library, currentPage, perPage, maxPage } = this.state;
            return (
                <div>
                    <div className="bg-PassengersList close_content"></div>
                    <section className="PassengersList-container">
                        <div className="PassengersList-title">
                            <span>
                                <i className="fa fa-user"></i>List of former Passengers
                            </span>
                            <span className="close-container close_content">
                                <i className="fa fa-times"></i>
                            </span>
                        </div>
                        <div className="PassengersList-content">
                            <div className="search-container">
                                <input
                                    type="search"
                                    value={this.state.filter} onChange={this.handleChange}
                                    className=""
                                    placeholder="Search"
                                />
                            </div>
                            <div class="list-container">
                                <div className="passenger-list-table">
                                    <div className="passenger-list-head">
                                        <div className="InternalOrExternal passenger-list-col passenger-list-tltcol">{this.state.InternalOrExternal}</div>
                                        <div className="passenger-list-col passenger-list-tltcol">Full name</div>
                                        <div className="passenger-list-col passenger-list-tltcol">Birthdate</div>
                                        <div className="passenger-list-col passenger-list-tltcol"></div>
                                    </div>
                                    <div className="loading-passengerList">
                                        <div className="passenger-list-row"><div id="fountainG"><div id="fountainG_1" class="fountainG"></div><div id="fountainG_2" className="fountainG"></div><div id="fountainG_3" className="fountainG"></div><div id="fountainG_4" className="fountainG"></div><div id="fountainG_5" className="fountainG"></div><div id="fountainG_6" className="fountainG"></div><div id="fountainG_7" className="fountainG"></div><div id="fountainG_8" className="fountainG"></div></div></div>
                                    </div>
                                    <div className="section-passengersList unvisible">
                                        {this.renderLibrary()}
                                    </div>
                                </div>
                            </div>

                            <ul id="page-numbers">
                                <li className="nexprevPage">
                                    {currentPage !== 1 && (
                                        <button onClick={this.previousPage} className="FirstPage">
                                            <i className="fa fa-backward"></i>
                                        </button>
                                    )}
                                </li>
                                <li className="controlsPage activepaging FirstPage">
                                    {this.state.currentPage}
                                </li>
                                <li className="restControls">...</li>
                                <li className="controlsPage LastPage">{this.state.maxPage}</li>
                                <li className="nexprevPage">
                                    {currentPage < maxPage && (
                                        <button onClick={this.nextPage} className="LastPage">
                                            <i className="fa fa-forward"></i>
                                        </button>
                                    )}
                                </li>
                            </ul>
                        </div>
                    </section>
                </div>
            );
        }
        renderInternal(element) {
            if (internal == 0) {
                return element.passportcode
            } else {
                return element.nationalcode
            }
        }
        renderInternal_label(element) {
            if (internal == 0) {
                return 'passport number'
            } else {
                return 'national code'
            }
        }
    }
    ReactDOM.render(<App />, document.getElementById("app"));
}
</script>
</body>
</html>
<basis core="call" file="footer-test.inc" />
<!----JS LIBRARY---->
<script src="https://cdn.basiscore.net/basisfly.com/js/reservation_date_pickerUi.js" type="text/javascript"></script>
<script src="https://cdn.basiscore.net/basisfly.com/js/reservation_date_picker.js" type="text/javascript"></script>
<script src="https://cdn.basiscore.net/basisfly.com/js/reservation_main_date_picker.js" type="text/javascript"></script>